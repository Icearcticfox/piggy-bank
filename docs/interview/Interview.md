Preparing to Interview

Resources:
1. https://github.com/Swfuse/devops-interview?tab=readme-ov-file
2. https://github.com/rmntrvn/adm_linux_ops_questions

---

## –û–±—â–µ–µ

### –£ –≤–∞—Å –µ—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä. –í—ã –Ω–∞–∂–∞–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∫–ª—é—á–µ–Ω–∏—è. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –û–°.

–ü–æ–¥–∞–µ—Ç—Å—è —Å–∏–≥–Ω–∞–ª –æ –ø–æ–¥–∞—á–µ –ø–∏—Ç–∞–Ω–∏—è, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è BIOS/UEFI (–ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –û–°). –ó–∞–≥—Ä—É–∑—á–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å–≤–æ–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ BIOS –∏—â–µ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –û–°:

- –∏—â–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Å–µ–∫—Ç–æ—Ä (MBR)
- —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–¥ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –µ–º—É,
- —ç—Ç–æ—Ç –∫–æ–¥ –∏—â–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª ("system partition"), –≤ –ø–µ—Ä–≤–æ–º —Ä–∞–∑–¥–µ–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π –∫–æ–¥ GRUB,
- GRUB –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞–∑—ã —è–¥—Ä–∞ –∏ initrd,
- –ø–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è–¥—Ä—É,
- —è–¥—Ä–æ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å init,
- init –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã —É—Ä–æ–≤–Ω–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (runlevel) –∏–∑¬†`/etc/rc.d/rc*.d/`.

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º:

- `S12syslog`¬†‚Äî –∑–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–∞ syslog,
- `S80sendmail`¬†‚Äî –∑–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–∞ sendmail.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, syslog –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –ø–µ—Ä–µ–¥ sendmail.

–ò—Å—Ç–æ—á–Ω–∏–∫:¬†https://habr.com/ru/post/518972/

### –û—Ç–∫—Ä—ã–ª–∏ linux –∫–æ–Ω—Å–æ–ª—å, –≤–≤–µ–ª–∏ curl¬†www.tinkoff.ru¬†- –Ω–∞–∂–∞–ª–∏ —ç–Ω—Ç–µ—Ä. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ.

curl ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ö–æ—Å—Ç–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º: FTP, FTPS, HTTP, HTTPS, TFTP, SCP, SFTP, Telnet, DICT, LDAP, POP3, IMAP –∏ SMTP.

–ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ curl –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –º–µ—Ç–æ–¥–æ–º GET –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É HTTP (—É—Ä–æ–≤–µ–Ω—å L7). –ü–µ—Ä–µ–¥ —ç—Ç–∏–º:

1. –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ DNS –∏–º–µ–Ω–∏ –≤ IP-–∞–¥—Ä–µ—Å –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É DNS,
	- –ü—Ä–æ—Ç–æ–∫–æ–ª: DNS
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π (7) ‚Äî DNS
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî UDP (–∏–ª–∏ TCP)
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP
2. –∑–∞–ø—Ä–æ—Å —É—Ö–æ–¥–∏—Ç –Ω–∞ DNS-—Å–µ—Ä–≤–µ—Ä, –¥–∞–ª–µ–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ ‚Äî –∫ –∫–æ—Ä–Ω–µ–≤—ã–º DNS –∏ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º,
	- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã: DNS ‚Üí —á–µ—Ä–µ–∑ UDP –∏–ª–∏ TCP (53 –ø–æ—Ä—Ç)
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π (7) ‚Äî DNS
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî UDP/TCP
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP
		- –ö–∞–Ω–∞–ª—å–Ω—ã–π (2) ‚Äî Ethernet/Wi-Fi
		- –§–∏–∑–∏—á–µ—Å–∫–∏–π (1)
3. –ø–æ–ª—É—á–∏–≤ IP, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ TCP (—Ç—Ä–µ—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ),
	- TCP (3-way handshake: SYN, SYN-ACK, ACK)
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî TCP
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP
		- –ö–∞–Ω–∞–ª—å–Ω—ã–π (2), –§–∏–∑–∏—á–µ—Å–∫–∏–π (1)
4. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–µ–∫ TCP/IP –∏ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏,
	- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã: IP (routing), TCP (session)
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî TCP
		- –ö–∞–Ω–∞–ª—å–Ω—ã–π (2), –§–∏–∑–∏—á–µ—Å–∫–∏–π (1)
5. –¥–∞–ª–µ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è HTTP-–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 80,
	- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã: HTTP
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π (7) ‚Äî HTTP
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî TCP
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP
6. –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.
	- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã: HTTP (–æ—Ç–≤–µ—Ç), TCP (–¥–æ—Å—Ç–∞–≤–∫–∞)
	- –£—Ä–æ–≤–Ω–∏ OSI:
		- –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π (7) ‚Äî HTTP
		- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (4) ‚Äî TCP
		- –°–µ—Ç–µ–≤–æ–π (3) ‚Äî IP

### –ó–∞—á–µ–º –º–∞—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
  
–ú–∞—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–∏ –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –±—É–¥–µ—Ç –ª–∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–∞–Ω–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ (L2) –Ω–∞–ø—Ä—è–º—É—é, –∏–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ —Å–µ—Ç–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ (L3).

---
**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–ö–æ–º–ø—å—é—Ç–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–≤–æ–π IP –∏ IP –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–∞—Å–∫—É –ø–æ–¥—Å–µ—Ç–∏ (–±–∏—Ç–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è AND).**
    
2. **–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (–æ–¥–Ω–∞ —Å–µ—Ç—å):**
    
    - –£–∑–µ–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–ª–æ–∫–∞–ª—å–Ω—ã–º‚Äù
        
    - –ü–µ—Ä–µ–¥–∞—á–∞ –∏–¥—ë—Ç –Ω–∞ **—É—Ä–æ–≤–Ω–µ L2 (Ethernet, ARP)**
        
    - –ü–∞–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é –∞–¥—Ä–µ—Å–∞—Ç—É**, –±–µ–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∏—Ä–æ–∫–æ–≤–µ—â–∞–Ω–∏–µ (broadcast) –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Å–µ—Ç–∏
        
    
3. **–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–Ω—ã–π (–¥—Ä—É–≥–∞—è —Å–µ—Ç—å):**
    
    - –£–∑–µ–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–º
        
    - –ü–µ—Ä–µ–¥–∞—á–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ **–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä (gateway)** –Ω–∞ **—É—Ä–æ–≤–Ω–µ L3**
        
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è IP-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, NAT –∏ —Ç.–¥.
        
    

---

> –ú–∞—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏. –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ—ë, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫ –∫–∞–∫–æ–º—É —É—Ä–æ–≤–Ω—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–∞–∫–µ—Ç–∞:

- > –µ—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –≤–Ω—É—Ç—Ä–∏ —Ç–æ–π –∂–µ –ø–æ–¥—Å–µ—Ç–∏ ‚Üí L2-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ARP –∏ –ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–∫—É;
    
- > –µ—Å–ª–∏ –≤ –¥—Ä—É–≥–æ–π –ø–æ–¥—Å–µ—Ç–∏ ‚Üí –ø–∞–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä (gateway), –∏ –¥–∞–ª–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ L3 –∏ –≤—ã—à–µ.
    

---

> –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–µ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å ARP-–∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.

### –ß—Ç–æ —Ç–∞–∫–æ–µ LoadAverage?

LoadAverage ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU –∑–∞ 1, 5 –∏ 15 –º–∏–Ω—É—Ç.

- **–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?**¬†–ü—Ä–æ—Ü–µ–Ω—Ç —É—Ç–∏–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è.
- **–í —á–µ–º –∏–∑–º–µ—Ä—è–µ—Ç—Å—è?**¬†–ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ —Ç–∏–∫–∞—Ö (–µ–¥–∏–Ω–∏—Ü—ã –≤—Ä–µ–º–µ–Ω–∏ CPU), —Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–æ–≤ –æ—Ç–¥–∞–Ω–æ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –ï—Å–ª–∏ > 100%, –∑–Ω–∞—á–∏—Ç –µ—Å—Ç—å –æ—á–µ—Ä–µ–¥—å –∏–∑ –æ–∂–∏–¥–∞—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
- **–ö–∞–∫–æ–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?**¬†–î–æ 1 –Ω–∞ 1 CPU (1.0 –Ω–∞ –æ–¥–Ω–æ —è–¥—Ä–æ).
- **–ï—Å–ª–∏ LA = 1000 ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ?**¬†–ù–µ—Ç, —ç—Ç–æ –ø–ª–æ—Ö–æ, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–µ 1000 —è–¥–µ—Ä –≤ —Å–∏—Å—Ç–µ–º–µ.
- **–ß—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ LA?**¬†–ù–∞–ø—Ä–∏–º–µ—Ä, iowait.

–í—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è wa (wait I/O) –∏ LA —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –æ D-state (–æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞), –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –¥–∏—Å–∫–∞–º–∏, —Å–µ—Ç—å—é, USB, —Å–æ–∫–µ—Ç–∞–º–∏ –∏ –¥—Ä.

### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ Linux

- **D**¬†‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞
- **R**¬†‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- **S**¬†‚Äî —Å–ø—è—â–∏–π, –∂–¥–µ—Ç —Å–æ–±—ã—Ç–∏—è
- **T**¬†‚Äî –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- **Z**¬†‚Äî –∑–æ–º–±–∏

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã:¬†`ps aux`

–ï—Å–ª–∏ wa (wait I/O) > 10-30%, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É.

–ò—Å—Ç–æ—á–Ω–∏–∫:¬†https://firstvds.ru/technology/nagruzka-na-server-opredelenie-prichin

### –ö—Ç–æ –∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –≥—Ä—É–ø–ø—É —É —Ñ–∞–π–ª–∞?

–ö–æ–º–∞–Ω–¥–∞:¬†`chown`

- **–¢—Ä–µ–±—É–µ—Ç—Å—è:**¬†–ª–∏–±–æ –±—ã—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Ñ–∞–π–ª–∞, –ª–∏–±–æ –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ root.

#### –ü—Ä–∏–º–µ—Ä:

```
-rw------- 1 user1 user1 147746 –º–∞—Ä 27 12:19 somefile
```

- `chown user1:user2 somefile`

- `chown user1:www-data somefile`

- **–ï—Å–ª–∏ –Ω–µ root:**¬†—Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ user1 —Å–æ—Å—Ç–æ–∏—Ç –≤ —ç—Ç–∏—Ö –≥—Ä—É–ø–ø–∞—Ö.

- **–ï—Å–ª–∏ root:**¬†—Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –≥—Ä—É–ø–ø—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
### –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ #1

**df** **(disk free)**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ —Ü–µ–ª–æ–º**, –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ—á–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
- –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ **—Ç–∞–±–ª–∏—Ü—É inodes –∏ –±–ª–æ–∫–æ–≤**, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–Ω—è—Ç–æ.
- –£—á–∏—Ç—ã–≤–∞–µ—Ç **–≤—Å–µ –¥–∞–Ω–Ω—ã–µ**, –≤–∫–ª—é—á–∞—è:
    - —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –Ω–æ –≤—Å—ë –µ—â—ë –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã;
    - –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–∫–µ—Ç–∞—Ö, pipes, tmpfs –∏ —Ç.–ø.
üî∏ **–¢–∏–ø–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã ‚Äî —è–¥—Ä–æ, —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã statfs().**

 **du**¬†**(disk usage)**
- –°—á–∏—Ç–∞–µ—Ç **—Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏**, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤ **—Ç–µ–∫—É—â–µ–º namespace**.
- –û–±—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ —Å—É–º–º–∏—Ä—É–µ—Ç **—Ä–∞–∑–º–µ—Ä—ã —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (–≤–∏–¥–∏–º—ã—Ö) —Ñ–∞–π–ª–æ–≤**.
- –ù–µ —Å—á–∏—Ç–∞–µ—Ç:
    - —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –Ω–æ –µ—â—ë –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã;
    - tmpfs, —Å–æ–∫–µ—Ç—ã, pipes –∏ –¥—Ä—É–≥–∏–µ –Ω–µ–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã.
üî∏ **–¢–∏–ø–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.**

**lsof** **(List Open Files)** ‚Äî —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ –≤ Linux/Unix, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–æ–∫–µ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ**. –í Linux **–≤—Å—ë ‚Äî —ç—Ç–æ —Ñ–∞–π–ª**, –≤–∫–ª—é—á–∞—è:

- –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã (/var/log/...)
- –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (/dev/sda)
- —Å–æ–∫–µ—Ç—ã (/tmp/.X11-unix)
- –∫–∞–Ω–∞–ª—ã (pipes)
- —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (TCP, UDP)

---


`df -Th`¬†–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Å—Ç–æ –µ—Å—Ç—å. –ù–æ¬†`touch file`¬†‚Äî –æ—à–∏–±–∫–∞ "No space left on device".

–ü—Ä–∏—á–∏–Ω—ã:

- –§–∞–π–ª—ã –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã, –Ω–æ –∑–∞–Ω—è—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

- –ü—Ä–æ–≤–µ—Ä–∫–∞:¬†`sudo lsof / | grep deleted`

- –ò—Å—á–µ—Ä–ø–∞–Ω—ã¬†**inodes**¬†‚Äî¬†`df -i`

- –ü–ª–æ—Ö–∏–µ –±–ª–æ–∫–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`fsck -vcck /dev/sdX`

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, FAT ‚Äî –º–∞–∫—Å. —Ñ–∞–π–ª 4GB)

–ò—Å—Ç–æ—á–Ω–∏–∫:¬†https://rtfm.co.ua/unix-df-i-du-raznye-znacheniya/¬†https://zalinux.ru/?p=3001

### –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ #2

–ö–æ—Ä–µ–Ω—å 100–ì–ë,¬†`df`¬†–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–Ω—è—Ç–æ –≤—Å—ë, –∞¬†`du -sh /*`¬†‚Äî —Ç–æ–ª—å–∫–æ 10–ì–ë.

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

- –§–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã, –Ω–æ –∑–∞–Ω—è—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.
- –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã:¬†`lsof | grep deleted`

#### –ü–æ—è—Å–Ω–µ–Ω–∏–µ: —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –∏ inodes

- **inode**¬†‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ñ–∞–π–ª–∞, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

- **fd (file descriptor)**¬†‚Äî "–±–∏–ª–µ—Ç" –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏.

- –û–¥–∏–Ω —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –º–Ω–æ–≥–∏–º–∏ fd.

- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è fd –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É —Ç–µ—Ä—è–µ—Ç—Å—è (–µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö).

### –ì–∏–ø–µ—Ä–≤–∏–∑–æ—Ä

–ì–∏–ø–µ—Ä–≤–∏–∑–æ—Ä ‚Äî —ç—Ç–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±–æ–ª–æ—á–∫–∞ (–ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏–ª–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —Å—Ö–µ–º–∞), –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –û–° –Ω–∞ –æ–¥–Ω–æ–º —Ö–æ—Å—Ç-–∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

–§—É–Ω–∫—Ü–∏–∏:
- –∏–∑–æ–ª—è—Ü–∏—è –û–°,
- –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞,
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤,
- –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è,
- –≤–∫–ª—é—á–µ–Ω–∏–µ/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –í–ú,
- –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –û–° (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —Å–µ—Ç–∏).

–ì–∏–ø–µ—Ä–≤–∏–∑–æ—Ä –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –º–∏–∫—Ä–æ—è–¥—Ä–æ–º ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –û–°, —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏?

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—â–µ–≥–æ —è–¥—Ä–∞ –û–° (—á–µ—Ä–µ–∑ `namespaces`, `cgroups`). –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω–∞—è –û–°.

**–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è:** –∑–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –û–° –ø–æ–≤–µ—Ä—Ö –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞. –ö–∞–∂–¥–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —è–¥—Ä–æ –∏ —Ä–µ—Å—É—Ä—Å—ã.

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ª–µ–≥—á–µ, –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ–Ω—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤.**

---
## Linux

### –í–∏–¥—ã –ø–∞–º—è—Ç–∏

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

| **–í–∏–¥ –ø–∞–º—è—Ç–∏**                   | **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ**                                                                | **–ì–¥–µ —Å–º–æ—Ç—Ä–∏–º**                  |
| -------------------------------- | -------------------------------------------------------------------------------- | -------------------------------- |
| **VSS (VSZ)** ‚Äì Virtual Set Size | –í—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤–∫–ª. –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, mmap, –∫—ç—à, –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—É—é). | ps, top, smem                    |
| **RSS** ‚Äì Resident Set Size      | –†–µ–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –≤ RAM –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (–±–µ–∑ —Å–≤–æ–ø–∞).                           | ps, top, smem, /proc/[pid]/statm |
| **PSS** ‚Äì Proportional Set Size  | RSS, –Ω–æ shared-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ–ª—è—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.                | smem, /proc/[pid]/smaps          |
| **USS** ‚Äì Unique Set Size        | –¢–æ–ª—å–∫–æ —Ç–∞ –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–π** –ø—Ä–æ—Ü–µ—Å—Å.                  | smem, /proc/[pid]/smaps          |
| **Shared memory**                | –û–±—â–∞—è –ø–∞–º—è—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).        | smem, pmap, /proc/[pid]/maps     |
| **Swap**                         | –°—Ç—Ä–∞–Ω–∏—Ü—ã, –≤—ã–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫ (–≤ swap).                                          | free, vmstat, top, smem          |
| **Page Cache**                   | –ö—ç—à —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å –¥–∏—Å–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —è–¥—Ä–æ–º.            | free, vmstat, /proc/meminfo      |
| **Buffers**                      | –ö—ç—à –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.                             | free, vmstat, /proc/meminfo      |
| **Slab**                         | –ö—ç—à —Å—Ç—Ä—É–∫—Ç—É—Ä —è–¥—Ä–∞ (inode, dentry, —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –∏ –ø—Ä.).                   | /proc/meminfo, slabtop           |
| **PageTables**                   | –ü–∞–º—è—Ç—å, –∑–∞–Ω–∏–º–∞–µ–º–∞—è —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.               | /proc/meminfo, smem, top         |
| **KernelStack**                  | –°—Ç–µ–∫ —è–¥—Ä–∞, –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞.                                        | /proc/meminfo, smem              |
#### –û–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞

| **–û–±–ª–∞—Å—Ç—å**     | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                         |
| --------------- | ------------------------------------------------------ |
| **Text (code)** | –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π –∫–æ–¥                                        |
| **Data**        | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ                                  |
| **Heap**        | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å (malloc, new)                      |
| **Stack**       | –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π                   |
| **mmap**        | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, shared libraries, –∞–Ω–æ–Ω–∏–º–Ω–∞—è –ø–∞–º—è—Ç—å |
–ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å –ø–æ–º–æ—â—å—é:

```
cat /proc/<pid>/maps
```

**üìä –ü—Ä–∏–º–µ—Ä smem**

```
sudo smem -r
```

|**PID**|**User**|**USS**|**PSS**|**RSS**|**Command**|
|---|---|---|---|---|---|
|123|root|10M|12M|14M|nginx|

#### üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

‚Ä¢ **–í—ã—Å–æ–∫–∏–π VSS** ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ mmap‚Äô–æ–≤, –Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).
‚Ä¢ **–í—ã—Å–æ–∫–∏–π RSS** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM.
‚Ä¢ **PSS** ‚Äî —Ö–æ—Ä–æ—à –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, —Å–∫–æ–ª—å–∫–æ ‚Äú–≤ —Å—Ä–µ–¥–Ω–µ–º‚Äù –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–∞–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç.
‚Ä¢ **USS** ‚Äî –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –±–µ–∑ —É—â–µ—Ä–±–∞ –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º.
‚Ä¢ **Swap > 0** ‚Äî –º–æ–∂–µ—Ç —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ –Ω–µ—Ö–≤–∞—Ç–∫–µ RAM.

### Namespaces and Cgroups

**namespaces –∏ cgroups** ‚Äî —ç—Ç–æ –¥–≤–∞ —Å—Ç–æ–ª–ø–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ Linux. –û–Ω–∏ –ª–µ–∂–∞—Ç –≤ –æ—Å–Ω–æ–≤–µ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Docker, Kubernetes)** –∏ –≤–æ–æ–±—â–µ –ª—é–±–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°.

–î–∞–≤–∞–π —Ä–∞–∑–ª–æ–∂–∏–º –Ω–∞ –ø–æ–Ω—è—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ:

---

#### üß± –ß—Ç–æ —Ç–∞–∫–æ–µ Linux namespaces?

**Namespaces** –ø–æ–∑–≤–æ–ª—è—é—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å **—Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã** –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

–¢–æ –µ—Å—Ç—å –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å ‚Äú–≤–∏–¥–∏—Ç‚Äù —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –µ–≥–æ namespace‚Äô—É.

##### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã namespace

| **Namespace** | **–ò–∑–æ–ª–∏—Ä—É–µ—Ç**                | **–ü—Ä–∏–º–µ—Ä**                 |
| ------------- | ---------------------------- | -------------------------- |
| mnt           | —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É             | –æ—Ç–¥–µ–ª—å–Ω—ã–π /, /proc         |
| pid           | –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ PID‚Äô—ã             | ps –ø–æ–∫–∞–∂–µ—Ç ‚Äú—Å–≤–æ–∏‚Äù PID      |
| net           | —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, IP       | –æ—Ç–¥–µ–ª—å–Ω—ã–π eth0             |
| uts           | –∏–º—è —Ö–æ—Å—Ç–∞ (hostname)         | hostname –±—É–¥–µ—Ç —Ä–∞–∑–Ω—ã–º      |
| ipc           | –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, semaphors | ipcs                       |
| user          | –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ UID/GID      | root –≤–Ω—É—Ç—Ä–∏, –Ω–æ –Ω–µ —Å–Ω–∞—Ä—É–∂–∏ |
| cgroup        | –∏–µ—Ä–∞—Ä—Ö–∏—é cgroups             | –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤ |

üìå –ö–∞–∂–¥—ã–π namespace –∏–∑–æ–ª–∏—Ä—É–µ—Ç —Å–≤–æ—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—É.

**üîß –ü—Ä–∏–º–µ—Ä –∏–∑–æ–ª—è—Ü–∏–∏ —Å unshare:**

```
sudo unshare --pid --fork --mount-proc bash
```

–¢–µ–ø–µ—Ä—å —Ç—ã –≤ –Ω–æ–≤–æ–º PID namespace ‚Üí ps –ø–æ–∫–∞–∂–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å.

---

#### üîí –ß—Ç–æ —Ç–∞–∫–æ–µ Linux cgroups?

**Cgroups (Control Groups)** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.

**üìå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ cgroups:**

‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ **CPU, RAM, disk IO, pids**
‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—á–µ—Ä–µ–∑ weight)
‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
‚Ä¢ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ –∏–µ—Ä–∞—Ä—Ö–∏—é

**–ü—Ä–∏–º–µ—Ä—ã —Ä–µ—Å—É—Ä—Å–æ–≤:**

| **–¢–∏–ø** | **–ß—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç** |
| ------- | -------------------- |
| cpu     | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU    |
| memory  | –æ–±—ä—ë–º RAM            |
| pids    | —á–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤      |
| blkio   | –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Å–∫—É       |
| devices | –¥–æ—Å—Ç—É–ø –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º |
**–ü—Ä–∏–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏:**

```
mkdir /sys/fs/cgroup/memory/mygroup
echo 100000000 > /sys/fs/cgroup/memory/mygroup/memory.limit_in_bytes
echo $$ > /sys/fs/cgroup/memory/mygroup/tasks
```

üìå –¢–µ–ø–µ—Ä—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ 100–ú–± RAM.

---

#### üì¶ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, docker run) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

‚Ä¢ **Namespaces** ‚Üí —á—Ç–æ–±—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Ñ–∞–π–ª–æ–≤, —Å–µ—Ç–∏)
‚Ä¢ **Cgroups** ‚Üí —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –æ–Ω –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤

---
#####  üê≥ –ü—Ä–∏–º–µ—Ä: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

1. –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π PID, NET, UTS, MNT, USER namespace ‚Üí —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äú—Å–≤–æ—è‚Äù –û–°
2. –°–æ–∑–¥–∞—é—Ç—Å—è cgroups –¥–ª—è CPU, memory –∏ pids
3. –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è overlayfs ‚Üí —Å–≤–æ—è –∫–æ—Ä–Ω–µ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
4. –í–Ω—É—Ç—Ä–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–≤–æ–π ENTRYPOINT –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ

---
#####  ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

||**Namespaces**|**Cgroups**|
|---|---|---|
|–ß—Ç–æ –¥–µ–ª–∞—é—Ç?|–ò–∑–æ–ª–∏—Ä—É—é—Ç|–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç|
|–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ|–í–∏–¥–∏–º–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤|–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤|
|–ü—Ä–∏–º–µ—Ä|—Å–≤–æ–π hostname|–º–∞–∫—Å–∏–º—É–º 512Mi –ø–∞–º—è—Ç–∏|


### Bash –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ $?, $0, $1, $@, $\$

#### $\$ 

```
echo $$
```

–≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç **PID (Process ID)** —Ç–µ–∫—É—â–µ–≥–æ shell-–ø—Ä–æ—Ü–µ—Å—Å–∞.

---

**üîç –ü–æ–¥—Ä–æ–±–Ω–æ:**

‚Ä¢ $ ‚Äî —ç—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è **–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ bash.

‚Ä¢ $\$ ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ bash, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç **PID —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞.

---

**üì¶ –ü—Ä–∏–º–µ—Ä:**
```
$ echo $$
12345
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±–æ–ª–æ—á–∫–∞ (shell), –≤ –∫–æ—Ç–æ—Ä–æ–π —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å ‚Äî –∏–º–µ–µ—Ç PID 12345.

---

**üß† –ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ?**

1. –ß—Ç–æ–±—ã:

‚Ä¢ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤ cgroup:

```
echo $$ > /sys/fs/cgroup/memory/mygroup/tasks
```

2. –û—Ç–ª–∞–∂–∏–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã:

```
echo "This script is running with PID $$"
```

3. –°–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ shell:

```
ps -fp $$
```

#### Special variables short

–ò–Ω–æ–≥–¥–∞ –∏—Ö —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞—é—Ç:

‚Ä¢ **–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è shell‚Äô–∞**
‚Ä¢ **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏** ($0, $1, $2, ‚Ä¶, $@, $*)
‚Ä¢ **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ shell (builtin shell variables)**

---

**üìò –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö:**

| **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è** | **–ó–Ω–∞—á–µ–Ω–∏–µ**                                            |
| -------------- | ------------------------------------------------------- |
| $$             | PID —Ç–µ–∫—É—â–µ–≥–æ shell-–ø—Ä–æ—Ü–µ—Å—Å–∞                             |
| $?             | –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã (0 = —É—Å–ø–µ—Ö, ‚â†0 = –æ—à–∏–±–∫–∞) |
| $0             | –ò–º—è —Å–∫—Ä–∏–ø—Ç–∞ (–∏–ª–∏ –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ shell)                    |
| $1, $2, ‚Ä¶      | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—É –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏               |
| $@             | –í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–∞–∫ —Å–ø–∏—Å–æ–∫ ("$1", "$2"‚Ä¶)                  |
| $*             | –í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–∞–∫ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ ("$1 $2 ...")             |

---

**üîç –ü—Ä–∏–º–µ—Ä—ã:**

```
#!/bin/bash
echo "Script name: $0"
echo "First arg: $1"
echo "Exit code of last cmd: $?"
echo "All args (\$@): $@"
echo "All args (\$*): $*"
```

–ï—Å–ª–∏ —Ç—ã –≤—ã–∑–æ–≤–µ—à—å:

```
./myscript.sh hello world
```

–¢–æ –ø–æ–ª—É—á–∏—à—å:

```
Script name: ./myscript.sh
First arg: hello
Exit code of last cmd: 0
All args ($@): hello world
All args ($*): hello world
```

---

**üß† –†–µ–∑—é–º–µ**

|**–ò–º—è**|**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**|**–ö–∞—Ç–µ–≥–æ—Ä–∏—è**|
|---|---|---|
|$$|PID —Ç–µ–∫—É—â–µ–≥–æ shell|—Å–ø–µ—Ü. –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è|
|$?|–ö–æ–¥ –≤—ã—Ö–æ–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã|—Å–ø–µ—Ü. –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è|
|$0|–ò–º—è —Å–∫—Ä–∏–ø—Ç–∞ –∏–ª–∏ shell|–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä|
|$1, $2|–ê—Ä–≥—É–º–µ–Ω—Ç—ã|–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã|
|$@, $*|–í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã|–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã|


### –ß—Ç–æ —Ç–∞–∫–æ–µ zombie –ø—Ä–æ—Ü–µ—Å—Å –∏ —á–µ–º —ç—Ç–æ –ø–ª–æ—Ö–æ, –∫–∞–∫ –µ–≥–æ —É–±–∏—Ç—å?

**Zombie (–∑–æ–º–±–∏)** ‚Äî –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–π—Å—è –ø—Ä–æ—Ü–µ—Å—Å, —á—å—è –∑–∞–ø–∏—Å—å –µ—â—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ (–æ–∂–∏–¥–∞–µ—Ç, –ø–æ–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª—å –≤—ã–∑–æ–≤–µ—Ç `wait()` –¥–ª—è —á—Ç–µ–Ω–∏—è exit-–∫–æ–¥–∞).

- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU/RAM, –Ω–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç **PID**.
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º —á–∏—Å–ª–µ –∑–æ–º–±–∏ ‚Äî –º–æ–∂–µ—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—å—Å—è –ø—É–ª PID.

**–£–±–∏—Ç—å:** –Ω–µ–ª—å–∑—è –Ω–∞–ø—Ä—è–º—É—é, –Ω—É–∂–Ω–æ —É–±–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è:
```bash
ps -ef | grep defunct
# –Ω–∞–π—Ç–∏ —Ä–æ–¥–∏—Ç–µ–ª—è, –∑–∞—Ç–µ–º:
sudo kill -9 <PID>
```
### –ß–µ–º –æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ?

- **–ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è inodes** ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤.
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ–∏—Å–∫, open/read).
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, SQLite, PostgreSQL).
- –†–∞–∑–±–∏–≤–∞—Ç—å –ø–æ –ø–æ–¥–ø–∞–ø–∫–∞–º (sharding –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É ID).
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3, GCS).

---

## GIT

### –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç?

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É¬†`git commit`¬†—Å —Ñ–ª–∞–≥–æ–º¬†`--amend`.
### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–±—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç?

–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –≤–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–º–º–∏—Ç —á–∞—Å—Ç—å —Ñ–∞–π–ª–æ–≤, –º–æ–∂–Ω–æ:

```
git add dir1
git commit

# –∑–∞–±—ã–ª–∏ dir2:
git add dir2
git commit --amend --no-edit
```

–§–ª–∞–≥¬†`--no-edit`¬†–ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∂–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞.
### –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è git revert –æ—Ç git reset?

- `git revert`¬†–æ—Ç–º–µ–Ω—è–µ—Ç¬†**–æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç**, —Å–æ–∑–¥–∞–≤ –Ω–æ–≤—ã–π –∫–æ–º–º–∏—Ç —Å –æ–±—Ä–∞—Ç–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.
- `git reset`¬†–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –∫ –ø—Ä–æ—à–ª–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é,¬†**—É–¥–∞–ª—è—è**¬†–≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–º–∏—Ç—ã (–µ—Å–ª–∏ hard).

---

## –°–µ—Ç—å

### OSI

Open Systems Interconnection

**üì∂ –ú–æ–¥–µ–ª—å OSI ‚Äî 7 —É—Ä–æ–≤–Ω–µ–π —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**

|**‚Ññ**|**–£—Ä–æ–≤–µ–Ω—å**|**–û–ø–∏—Å–∞–Ω–∏–µ**|**–ü—Ä–∏–º–µ—Ä—ã**|
|---|---|---|---|
|7|**–ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π (Application)**|–¢–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å|HTTP, FTP, DNS, SSH|
|6|**–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Presentation)**|–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö, –∫–æ–¥–∏—Ä–æ–≤–∫–∞, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ|TLS/SSL, JPEG, MP3|
|5|**–°–µ–∞–Ω—Å–æ–≤—ã–π (Session)**|–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏|SSH-—Å–µ—Å—Å–∏—è, RPC, NetBIOS|
|4|**–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π (Transport)**|–î–æ—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å|TCP, UDP|
|3|**–°–µ—Ç–µ–≤–æ–π (Network)**|–ê–¥—Ä–µ—Å–∞—Ü–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è|IP, ICMP|
|2|**–ö–∞–Ω–∞–ª—å–Ω—ã–π (Data Link)**|–î–æ—Å—Ç–∞–≤–∫–∞ –∫–∞–¥—Ä–æ–≤ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏|Ethernet, Wi-Fi, PPP|
|1|**–§–∏–∑–∏—á–µ—Å–∫–∏–π (Physical)**|–ë–∏—Ç—ã, –∫–∞–±–µ–ª–∏, —Å–∏–≥–Ω–∞–ª—ã|RJ-45, –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ, Wi-Fi|
–ú–Ω–µ–º–æ–Ω–∏–∫–∞:

üîΩ **–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö**:

> **P**lease **D**o **N**ot **T**hrow **S**ausage **P**izza **A**way

(Physical, Data Link, Network, Transport, Session, Presentation, Application)

---

**üîç –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–¥–∞—á–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞:**

1. **HTTP-–∑–∞–ø—Ä–æ—Å** (Application)
2. –®–∏—Ñ—Ä—É–µ—Ç—Å—è –≤ **TLS** (Presentation)
3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **—Å–µ–∞–Ω—Å–æ–º TLS** (Session)
4. –î–µ–ª–∏—Ç—Å—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã TCP (Transport)
5. –î–æ—Å—Ç–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ IP-–∞–¥—Ä–µ—Å (Network)
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ Ethernet/Wi-Fi (Data Link)
7. –ß–µ—Ä–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∫–∞–±–µ–ª—å –∏–ª–∏ —Å–∏–≥–Ω–∞–ª (Physical)

### L4/L7 LB

–†–∞–∑–±–µ—Ä—ë–º **L4, L7 –∏ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–≤**, –∏ –≤ —á—ë–º –∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.

**üåê –£—Ä–æ–≤–Ω–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ (–ø–æ OSI-–º–æ–¥–µ–ª–∏)**

#### ‚úÖ L4-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)

üìå –û—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞: **IP-–∞–¥—Ä–µ—Å–∞—Ö + TCP/UDP-–ø–æ—Ä—Ç–∞—Ö**

**üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

‚Ä¢ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫, **–Ω–µ –∑–∞–≥–ª—è–¥—ã–≤–∞—è –≤–Ω—É—Ç—Ä—å –ø–∞–∫–µ—Ç–∞**.

‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ 5-tuple: src IP, src port, dst IP, dst port, protocol.

**üîß –ü—Ä–∏–º–µ—Ä—ã:**

‚Ä¢ iptables / ipvs
‚Ä¢ Linux LVS
‚Ä¢ HAProxy (L4 —Ä–µ–∂–∏–º)
‚Ä¢ AWS Network Load Balancer (NLB)
‚Ä¢ MetalLB –≤ Kubernetes

**‚ûï –ü–ª—é—Å—ã:**

‚Ä¢ –ë—ã—Å—Ç—Ä–æ
‚Ä¢ –ù–∏–∑–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
‚Ä¢ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è TCP/UDP

**‚ûñ –ú–∏–Ω—É—Å—ã:**

‚Ä¢ –ù–µ –≤–∏–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, URL, cookie)
‚Ä¢ –ù–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –∑–∞–ø—Ä–æ—Å–∞

---

#### ‚úÖ L7-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (–ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å)

üìå –û—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞: **—Å–æ–¥–µ—Ä–∂–∏–º–æ–º HTTP/HTTPS, gRPC, WebSocket –∏ —Ç.–¥.**


**üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

‚Ä¢ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é**: –ø—É—Ç—å, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫—É–∫–∏, —Ç–µ–ª–æ –∏ —Ç.–ø.
‚Ä¢ –ú–æ–∂–µ—Ç **–¥–µ–ª–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –ø–æ URL, —Ö–æ—Å—Ç—É, –º–µ—Ç–æ–¥—É**, –∏ –¥–∞–∂–µ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É.

**üîß –ü—Ä–∏–º–µ—Ä—ã:**

‚Ä¢ NGINX, Envoy, Traefik, HAProxy (L7)
‚Ä¢ Kubernetes Ingress Controllers
‚Ä¢ AWS Application Load Balancer (ALB)
‚Ä¢ Istio / Linkerd (–≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–π mesh‚Äô–µ)

**‚ûï –ü–ª—é—Å—ã:**

‚Ä¢ –ì–∏–±–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–Ω–∞—Ä–µ–µ–∫, A/B, blue/green
‚Ä¢ –ú–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å rate limiting, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**‚ûñ –ú–∏–Ω—É—Å—ã:**

‚Ä¢ –í—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞
‚Ä¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º L4
‚Ä¢ –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è ‚Äú—Å—ã—Ä–æ–≥–æ‚Äù TCP/UDP

---

**üì¶ –ï—Å—Ç—å –ª–∏ –¥—Ä—É–≥–∏–µ —É—Ä–æ–≤–Ω–∏?**

#### ‚úÖ L3-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (—Å–µ—Ç–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å)

üìå –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ IP –±–µ–∑ –ø–æ—Ä—Ç–æ–≤

‚Ä¢ –û—á–µ–Ω—å –±–∞–∑–æ–≤–∞—è, –ø–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –Ω–∞–ø—Ä—è–º—É—é
‚Ä¢ –ü—Ä–∏–º–µ—Ä: BGP + ECMP (Equal-cost multi-path routing), IP-routing

#### ‚úÖ L2-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (–∫–∞–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)

üìå –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ MAC-–∞–¥—Ä–µ—Å–∞ –∏ ARP

‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∂–µ–ª–µ–∑–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
‚Ä¢ –ü—Ä–∏–º–µ—Ä: –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ L2-–º–æ—Å—Ç—ã, ARP spoofing/rewriting (—Ä–µ–¥–∫–æ—Å—Ç—å)

#### üß† –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ

|**–£—Ä–æ–≤–µ–Ω—å**|**–ß—Ç–æ –≤–∏–¥–∏—Ç?**|**–ü—Ä–∏–º–µ—Ä—ã**|**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**|
|---|---|---|---|
|**L7**|HTTP, gRPC, Headers|ALB, Ingress, NGINX|–£–º–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è|
|**L4**|TCP/UDP|NLB, LVS, iptables|–ë—ã—Å—Ç—Ä–æ, –Ω–µ —á–∏—Ç–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã|
|**L3**|IP-–∞–¥—Ä–µ—Å–∞|BGP, ECMP|–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å, routing|
|**L2**|MAC-–∞–¥—Ä–µ—Å–∞|ARP proxy, –º–æ—Å—Ç—ã|–ü–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–ª–∞—É–¥–µ|

---

#### üß™ –í Kubernetes

‚Ä¢ **Service type: LoadBalancer** ‚Äî –æ–±—ã—á–Ω–æ L4 (NLB –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
‚Ä¢ **Ingress Controller** ‚Äî L7 (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å HTTP)
‚Ä¢ **Service Mesh (Istio, Linkerd)** ‚Äî L7 –ø—Ä–æ–∫—Å–∏ —Å deep inspection


–í **Kubernetes** —É—Ä–æ–≤–Ω–∏ **L4 –∏ L7** **—á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–µ**, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ —Ä–µ—à–∞—é—Ç **—Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏** –Ω–∞ –ø—É—Ç–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º **–ø–æ—à–∞–≥–æ–≤–æ –∏ –Ω–∞–≥–ª—è–¥–Ω–æ**, –∫–∞–∫ –æ–Ω–∏ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è.
###### üß≠ –ö—Ä–∞—Ç–∫–æ: –∫–∞–∫ —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

```
Client ‚Üí L4 LoadBalancer ‚Üí NodePort / ClusterIP (L4) ‚Üí Ingress Controller (L7) ‚Üí App
```

---

**üî∑ 1. L4 –≤ Kubernetes**

L4 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **IP + TCP/UDP –ø–æ—Ä—Ç–∞—Ö**. –í Kubernetes —ç—Ç–æ:

**‚úÖ –ü—Ä–∏–º–µ—Ä—ã L4-–æ–±—ä–µ–∫—Ç–æ–≤:**

|**–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞**|**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**|**–£—Ä–æ–≤–µ–Ω—å**|
|---|---|---|
|Service: ClusterIP|L4 –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞|L4|
|Service: NodePort|–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö|L4|
|Service: LoadBalancer|–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º L4 –±–∞–ª–∞–Ω—Å–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, NLB)|L4|

üìå –í–∞–∂–Ω–æ: LoadBalancer ‚Äî —ç—Ç–æ **–≤–Ω–µ—à–Ω–∏–π L4-–±–∞–ª–∞–Ω—Å–µ—Ä**, –Ω–∞–ø—Ä–∏–º–µ—Ä, AWS NLB –∏–ª–∏ GCP TCP balancer, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç ‚Äú—Ä–∞–∑–¥–∞–≤–∞—Ç—å‚Äù —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ NodePort —Å–µ—Ä–≤–∏—Å–∞.

---

**üî∂ 2. L7 –≤ Kubernetes**

**‚úÖ –ö–∞–∫ —Ç–æ–ª—å–∫–æ L4-—Ç—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ Ingress Controller (–Ω–∞–ø—Ä–∏–º–µ—Ä, NGINX, Traefik, Envoy):**

‚Ä¢ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è **L7-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞**:

–†–∞–∑–±–æ—Ä HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ:

‚Ä¢ host (–Ω–∞–ø—Ä–∏–º–µ—Ä, api.example.com)

‚Ä¢ path (–Ω–∞–ø—Ä–∏–º–µ—Ä, /v1/ ‚Üí –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å, /admin ‚Üí –¥—Ä—É–≥–æ–π)

‚Ä¢ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, –º–µ—Ç–æ–¥–∞–º, –∏ —Ç.–ø.

**‚úÖ –ü—Ä–∏–º–µ—Ä—ã L7:**

‚Ä¢ Ingress —Ä–µ—Å—É—Ä—Å

‚Ä¢ IngressRoute (Traefik CRD)

‚Ä¢ VirtualService (–≤ Istio)

---

###### üß™ –ü—Ä–∏–º–µ—Ä —Ç—Ä–∞—Ñ–∏–∫–∞:

**üëâ –¢—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –±—Ä–∞—É–∑–µ—Ä:**

```
https://app.example.com/login
```

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. üåç –ó–∞–ø—Ä–æ—Å —É—Ö–æ–¥–∏—Ç –Ω–∞ **–≤–Ω–µ—à–Ω–∏–π IP LoadBalancer‚Äô–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, AWS NLB) ‚Äî **L4**

2. üö™ –û–Ω –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ NodePort –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–≤—Å–µ –Ω–æ–¥—ã —Å–ª—É—à–∞—é—Ç –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç) ‚Äî **L4**

3. üì¶ –ü–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ pod —Å **Ingress Controller‚Äô–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, NGINX)** ‚Äî —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è **L7**

4. üß† NGINX —Å–º–æ—Ç—Ä–∏—Ç:

‚Ä¢ Host: app.example.com

‚Ä¢ Path: /login

5. üõ£ –ù–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –Ω—É–∂–Ω—ã–π backend-—Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, auth-service) ‚Äî —É–∂–µ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞

---

**üîÅ –°—Ö–µ–º–∞**

```
    [ Client ]
        |
    [ L4 LoadBalancer ]  ‚Üê external (AWS NLB, GCP LB)
        |
    [ NodePort Service ] ‚Üê kube-proxy, iptables (L4)
        |
    [ Ingress Controller Pod ] ‚Üê nginx, envoy (L7)
        |
    [ Target App Service / Pod ]
```

---

###### ü§ì –ê –µ—Å–ª–∏ Service Mesh (–Ω–∞–ø—Ä–∏–º–µ—Ä, Istio)?

‚Ä¢ Istio **–≤—Å—Ç–∞–≤–ª—è–µ—Ç L7-–ø—Ä–æ–∫—Å–∏ (Envoy)** _–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º pod‚Äô–æ–º_

‚Ä¢ –¢—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç:

‚Ä¢ L4 ‚Üí Ingress Gateway (L7)

‚Ä¢ –ü–æ—Ç–æ–º –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏ —Ç–æ–∂–µ L7 ‚Üí –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞, –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–µ —Ä–µ–ª–∏–∑—ã –∏ —Ç.–ø.

---
###### üß† –†–µ–∑—é–º–µ

| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**        | **–£—Ä–æ–≤–µ–Ω—å** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                         |
| -------------------- | ----------- | -------------------------------------- |
| LoadBalancer Service | L4          | –î–æ—Å—Ç—É–ø —Å–Ω–∞—Ä—É–∂–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞                |
| NodePort / ClusterIP | L4          | –†–æ—É—Ç–∏–Ω–≥ –Ω–∞ pod‚Äô—ã –≤–Ω—É—Ç—Ä–∏                |
| Ingress Controller   | L7          | HTTP/HTTPS –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è               |
| Service Mesh         | L7          | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏ |

---

### TCP vs UDP. –†–∞–∑–Ω–∏—Ü–∞

- **TCP** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–∞–∫–µ—Ç–æ–≤.
- **UDP** ‚Äî –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ, DNS –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≥–¥–µ –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å.

### –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç TCP-handshake?

**–ö—Ä–∞—Ç–∫–æ:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SYN —Å seq=A.
2. –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç SYN+ACK —Å seq=B –∏ ack=A+1.
3. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK —Å seq=A+1 –∏ ack=B+1.

**–ü–æ–¥—Ä–æ–±–Ω–æ:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ–≥–º–µ–Ω—Ç —Å SYN –∏ —Å–ª—É—á–∞–π–Ω—ã–º seq (A).
2. –°–µ—Ä–≤–µ—Ä –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç seq –∫–ª–∏–µ–Ω—Ç–∞, –≤—ã–¥–µ–ª—è–µ—Ç —Å–æ–∫–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SYN+ACK (seq=B, ack=A+1) –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ SYN-RECEIVED. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî RST.
3. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç SYN+ACK, –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç seq —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ ESTABLISHED. –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª RST ‚Äî –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ–ø—ã—Ç–∫—É. –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ ‚Äî –ø–æ–≤—Ç–æ—Ä.
4. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ ACK –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ ESTABLISHED. –ï—Å–ª–∏ –Ω–µ—Ç ACK ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã? –ö–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ? (https —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)

–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. –ë—Ä–∞—É–∑–µ—Ä –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–µ–±-—Å–∞–π—Ç—É (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É), –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —Å –ø–æ–º–æ—â—å—é SSL.
2. –ë—Ä–∞—É–∑–µ—Ä –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞.
3. –í –æ—Ç–≤–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä—É –∫–æ–ø–∏—é —Å–≤–æ–µ–≥–æ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á.
4. –ë—Ä–∞—É–∑–µ—Ä –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º. –£ –Ω–µ–≥–æ —É–∂–µ –∑–∞—à–∏—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —Å –ø–æ–º–æ—â—å—é —Ü–µ–Ω—Ç—Ä–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–∫, –æ–Ω —Å–æ–æ–±—â–∞–µ—Ç –æ–± —ç—Ç–æ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–µ–Ω–∞—Å–æ–≤—ã–π –∫–ª—é—á, —à–∏—Ñ—Ä—É–µ—Ç –ø–µ–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
5. –°–µ–µ—Ä–≤–µ—Ä —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ–∞–Ω—Å–æ–≤—ã–π –∫–ª—é—á. –ó–∞—Ç–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–µ–∞–Ω—Å, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SSL.
6. –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º.


### –û–ø–∏—à–∏ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã ssl-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

–í –æ—Å–Ω–æ–≤–µ –ª—é–±–æ–≥–æ –º–µ—Ç–æ–¥–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ª–µ–∂–∏—Ç –∫–ª—é—á. –ö–ª—é—á ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ. –í —Ä–∞–±–æ—Ç–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —É—á–∞—Å—Ç–≤—É—é—Ç —Ç—Ä–∏ –∫–ª—é—á–∞: –ø—É–±–ª–∏—á–Ω—ã–π, –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ —Å–µ–∞–Ω—Å–æ–≤—ã–π.

**–ü—É–±–ª–∏—á–Ω—ã–π**¬†–∫–ª—é—á –∑–∞—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

–ë—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –≤–≤–µ–ª–∏ –¥–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã –∏ –Ω–∞–∂–∞–ª–∏ ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª. –≠—Ç–æ—Ç –∫–ª—é—á –≤–∏–¥–µ–Ω –≤—Å–µ–º, –±—Ä–∞—É–∑–µ—Ä –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –µ–≥–æ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é.

**–ü—Ä–∏–≤–∞—Ç–Ω—ã–π**¬†–∫–ª—é—á —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

–ï–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä, –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞. –≠—Ç–æ—Ç –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

**–°–µ–∞–Ω—Å–æ–≤—ã–π**¬†–∫–ª—é—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

–ë—Ä–∞—É–∑–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç–µ. –°—Ç–æ–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É, —Å–µ–∞–Ω—Å –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –∏ –∫–ª—é—á –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

–ü—É–±–ª–∏—á–Ω—ã–π –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–ø—É—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ. –ï—Å–ª–∏ –∫–ª—é—á –ø–æ–ø–∞–¥—ë—Ç –≤ —Ä—É–∫–∏ –¥—Ä—É–≥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É, –æ–Ω —Å–º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ –≤–∞–º –ø—Ä–∏–¥—ë—Ç—Å—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –Ω–∞–∑—ã–≤–∞—é—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–º.**¬†–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π –º–µ—Ç–æ–¥ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ. –ü–æ—ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ –æ–¥–∏–Ω —Ä–∞–∑: —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–µ–∞–Ω—Å–æ–≤—ã–π –∫–ª—é—á.

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –Ω–∞–∑—ã–≤–∞—é—Ç —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–º.**¬†–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–¥–æ–±–µ–Ω, –Ω–æ –Ω–µ —Ç–∞–∫ –±–µ–∑–æ–ø–∞—Å–µ–Ω. –ü–æ—ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä –∏ –¥–µ–ª–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–∞–Ω—Å–∞ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –∏ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.
### –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

üîë **–û–¥–∏–Ω –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**

–í —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á** –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å **–æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º**.
2. –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å **—à–∏—Ñ—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –∫–ª—é—á–∞.
3. –ü–æ–ª—É—á–∞—Ç–µ–ª—å **—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ**, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ—Ç –∂–µ –∫–ª—é—á.
#### –ü—Ä–∏–º–µ—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤:

‚Ä¢ **AES (Advanced Encryption Standard)** ‚Äì —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.
‚Ä¢ **DES (Data Encryption Standard)** ‚Äì —É—Å—Ç–∞—Ä–µ–ª, –Ω–æ –±—ã–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –≤ –ø—Ä–æ—à–ª–æ–º.
‚Ä¢ **3DES (Triple DES)** ‚Äì —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è DES.
‚Ä¢ **RC4** ‚Äì –ø–æ—Ç–æ–∫–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —Å–µ–π—á–∞—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º.
#### –ü–ª—é—Å—ã

‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ.
‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
#### –ú–∏–Ω—É—Å—ã

‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ **–±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–ª—é—á** –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º.
‚ùå –ï—Å–ª–∏ –∫–ª—é—á —É–∫—Ä–∞–¥—É—Ç, **–∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —Å–º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**.
### –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

üîë **–î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–∞: –ø—É–±–ª–∏—á–Ω—ã–π –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π**

–í –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–ø–∞—Ä–∞ –∫–ª—é—á–µ–π**:

‚Ä¢ **–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.
‚Ä¢ **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.
#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** –ø–æ–ª—É—á–∞—Ç–µ–ª—è.
2. –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å **—à–∏—Ñ—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** —Å –ø–æ–º–æ—â—å—é **–ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞**.
3. –ü–æ–ª—É—á–∞—Ç–µ–ª—å **–¥–µ—à–∏—Ñ—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** —Å –ø–æ–º–æ—â—å—é **–ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞**.
#### –ü—Ä–∏–º–µ—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤:

‚Ä¢ **RSA (Rivest-Shamir-Adleman)** ‚Äì –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤.
‚Ä¢ **ECC (Elliptic Curve Cryptography)** ‚Äì –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–∏ –º–µ–Ω—å—à–∏—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö –∫–ª—é—á–µ–π.
‚Ä¢ **DSA (Digital Signature Algorithm)** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π.
#### –ü–ª—é—Å—ã

‚úÖ **–ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á**, —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π.
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ**, —Ç–∞–∫ –∫–∞–∫ –≤–∑–ª–æ–º —Ç—Ä–µ–±—É–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª).
#### –ú–∏–Ω—É—Å—ã

‚ùå **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ**, —á–µ–º —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (–∏–∑-–∑–∞ —Å–ª–æ–∂–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π).
‚ùå **–ú–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
### –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è

||**–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**|**–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**|
|---|---|---|
|üîë **–ö–ª—é—á–∏**|–û–¥–∏–Ω –æ–±—â–∏–π –∫–ª—é—á|–ü–∞—Ä–∞ –∫–ª—é—á–µ–π (–ø—É–±–ª–∏—á–Ω—ã–π + –ø—Ä–∏–≤–∞—Ç–Ω—ã–π)|
|‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å**|–ë—ã—Å—Ç—Ä–µ–µ|–ú–µ–¥–ª–µ–Ω–Ω–µ–µ|
|üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**|–£—è–∑–≤–∏–º–æ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∫–ª—é—á–∞|–ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ|
|üîÅ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**|–•–æ—Ä–æ—à–æ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–ª—é—á–µ–≤–æ–≥–æ –æ–±–º–µ–Ω–∞ –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π|
### –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

üìå **–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** ‚Äì –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª–æ–≤, –¥–∏—Å–∫–æ–≤, VPN).

üìå **–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** ‚Äì –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏, —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã (PGP), TLS/SSL –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.

üí° **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ HTTPS –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Å–Ω–∞—á–∞–ª–∞ **–æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –∫–ª—é—á–∞–º–∏ —á–µ—Ä–µ–∑ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (RSA)**, –∞ –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (AES) –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö**.

### –í—ã–≤–æ–¥

‚Ä¢ **–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏.
‚Ä¢ **–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ**, –Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª—é—á–µ–π.
‚Ä¢ **–í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö** –æ–Ω–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–µ!


### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–∞–±–ª–∏—Ü–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏?

–≠—Ç–æ —Ç–∞–±–ª–∏—Ü–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏ –∏ —Å–µ—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–ø–∞ (gateway).

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –¥–æ IP 1.2.3.4:**
```bash
traceroute 1.2.3.4
ip route get 1.2.3.4
```

### IPTables: SNAT, DNAT, –ú–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
#### 1. Filter Table
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ (DROP, LOG, ACCEPT, REJECT).
- –¶–µ–ø–æ—á–∫–∏:
  - INPUT (–ø–∞–∫–µ—Ç—ã –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)
  - OUTPUT (–∏—Å—Ö–æ–¥—è—â–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ)
  - FORWARD (—Ç—Ä–∞–Ω–∑–∏—Ç–Ω—ã–µ)

#### 2. NAT Table
- –î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ç–µ–≤—ã—Ö –∞–¥—Ä–µ—Å–æ–≤.
- –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É.
- –¶–µ–ø–æ—á–∫–∏:
  - PREROUTING ‚Äî DNAT
  - POSTROUTING ‚Äî SNAT
  - OUTPUT ‚Äî NAT –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

#### 3. Mangle Table
- –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: TOS, TTL, MARK –∏ –¥—Ä.
- –¶–µ–ø–æ—á–∫–∏:
  - PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING

#### 4. Raw Table
- –î–æ connection tracking (state machine)
- –¶–µ–ø–æ—á–∫–∏: PREROUTING, OUTPUT

#### –¶–µ–ø–æ—á–∫–∏ IPTables:
- PREROUTING ‚Äî –¥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- INPUT ‚Äî –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
- FORWARD ‚Äî —Ç—Ä–∞–Ω–∑–∏—Ç–Ω—ã–µ
- OUTPUT ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏—Å—Ö–æ–¥—è—â–∏–µ
- POSTROUTING ‚Äî –ø–æ—Å–ª–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–ø–∏—Å—å 10.12.15.35/22?

CIDR-–±–ª–æ–∫ `/22`:
- –ú–∞—Å–∫–∞: `255.255.252.0`
- –î–∏–∞–ø–∞–∑–æ–Ω: `10.12.12.0 ‚Äì 10.12.15.255`
- –ü—Ä–∏–º–µ—Ä —á–∞—Å—Ç–Ω–æ–π —Å–µ—Ç–∏ —Å 1024 –∞–¥—Ä–µ—Å–∞–º–∏, 64 –ø–æ–¥—Å–µ—Ç–∏.

### DNS

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–∏ DNS (RR):**

- NAME ‚Äî –¥–æ–º–µ–Ω

- TYPE ‚Äî —Ç–∏–ø –∑–∞–ø–∏—Å–∏ (A, AAAA, MX, CNAME...)

- CLASS ‚Äî —Ç–∏–ø —Å–µ—Ç–∏ (–æ–±—ã—á–Ω–æ IN)

- TTL ‚Äî —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –≤ –∫—ç—à–µ

- RDLEN ‚Äî –¥–ª–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö

- RDATA ‚Äî —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

**–¢–∏–ø—ã –∑–∞–ø–∏—Å–µ–π:**

- A ‚Äî IPv4 –∞–¥—Ä–µ—Å  

- AAAA ‚Äî IPv6 –∞–¥—Ä–µ—Å

- CNAME ‚Äî –ø—Å–µ–≤–¥–æ–Ω–∏–º (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–µ –∏–º—è)

- MX ‚Äî –ø–æ—á—Ç–æ–≤—ã–π –æ–±–º–µ–Ω–Ω–∏–∫

- NS ‚Äî DNS —Å–µ—Ä–≤–µ—Ä –∑–æ–Ω—ã

- PTR ‚Äî –æ–±—Ä–∞—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å IP ‚Üí –∏–º—è

- SOA ‚Äî –Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –∑–æ–Ω—ã

- SRV ‚Äî —Å–µ—Ä–≤–µ—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Jabber, Active Directory)

#### –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∏ –Ω–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å

–ü—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –í—ã –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É, –∞ –æ–Ω, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ—Ç —É —Å–µ–±—è –Ω—É–∂–Ω–æ–π –∑–∞–ø–∏—Å–∏, –∏–¥–µ—Ç –∫ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –Ω–∏—Ö.

–ù–µ—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π dns —Å–µ—Ä–≤–µ—Ä –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç - "—è –Ω–µ –∑–Ω–∞—é, –Ω–æ —Å–ø—Ä–æ—Å–∏ —É —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞". –ò –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç —Å–ª–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å. –ü–æ–Ω—è—Ç–Ω–æ–µ –¥–µ–ª–æ, —á—Ç–æ –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ª—É—á—à–µ.

### –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤ –∏ —Å–æ–∫–µ—Ç–æ–≤
```bash
ss -tlpn
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
```bash
ip a
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
```bash
ip route
```

### NetCat (nc)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞:**
```bash
nc -vn 192.168.1.100 12345
```

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:**
```bash
nc -vnz 192.168.1.100 20-24
```

–ò—Å—Ç–æ—á–Ω–∏–∫: https://habr.com/ru/post/336596/

### Nmap

**–ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤ –≤ –ø–æ–¥—Å–µ—Ç–∏:**
```bash
nmap -sP 192.168.1.0/24
nmap -sn 192.168.1.0/24
```

### Tcpdump

**–ü—Ä–∏–º–µ—Ä:**
```bash
tcpdump -i any -s0
```
- `-i` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `-s` ‚Äî —Ä–∞–∑–º–µ—Ä –∑–∞—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–∞ (0 ‚Äî –≤–µ—Å—å)


---

## Docker

#### –ö–∞–∫ –≤–Ω—É—Ç—Ä–∏ Docker –ø–æ–Ω—è—Ç—å —á—Ç–æ —Ç—ã –≤ Docker?

##### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ /.dockerenv

```
test -f /.dockerenv && echo "Inside Docker"
```

‚Ä¢ **–ü–ª—é—Å—ã**: –ù–∞–¥—ë–∂–Ω–æ, —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞—ë—Ç Docker –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
‚Ä¢ **–ú–∏–Ω—É—Å—ã**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ä–µ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kubernetes) –º–æ–≥—É—Ç –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª.

–¢–∞–∫–∂–µ, –µ—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –¥—Ä—É–≥–æ–π runtime (containerd, Podman), —Ñ–∞–π–ª –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

---
##### 2. –ß—Ç–µ–Ω–∏–µ cgroup

```
cat /proc/1/cgroup
```

–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
0::/docker/abc123...
```

–∏–ª–∏

```
1:name=systemd:/docker/abc123
```

‚Äî —Ç–æ —Ç—ã, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤ Docker.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ bash:**

```
grep -qE "/docker/|/kubepods/" /proc/1/cgroup && echo "Inside container"
```

‚Ä¢ kubepods ‚Üí —Ç—ã –≤–Ω—É—Ç—Ä–∏ Kubernetes.

‚Ä¢ docker ‚Üí –≤ Docker –Ω–∞–ø—Ä—è–º—É—é.

---
##### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ hostname

–ò–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ hostname = –∫–æ—Ä–æ—Ç–∫–∏–π —Å–ª—É—á–∞–π–Ω—ã–π hash (Docker –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –∫–∞–∫ container ID). –ü—Ä–∏–º–µ—Ä:

```
hostname
```

–ú–æ–∂–µ—Ç –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ 0a1b2c3d4e5f.

üìå –ù–µ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–±, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ—Å–≤–µ–Ω–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º.

---

##### ‚ö†Ô∏è 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π cgroups

–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —É —Ç–µ–±—è:

```
cat /sys/fs/cgroup/memory/memory.limit_in_bytes
```

–ò –∑–Ω–∞—á–µ–Ω–∏–µ **—Å–∏–ª—å–Ω–æ –º–µ–Ω—å—à–µ**, —á–µ–º —É —Ç–≤–æ–µ–π –º–∞—à–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 512MB –∏–ª–∏ 1GB), —Ç—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤.

---

##### üß† –ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –ª—É—á—à–µ?

|**–ú–µ—Ç–æ–¥**|**–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**|**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π**|
|---|---|---|
|/.dockerenv|‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è|–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Docker|
|/proc/1/cgroup|‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è|–†–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ k8s|
|hostname|‚ö†Ô∏è –ù–∏–∑–∫–∞—è|–ö–æ—Å–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫|
|cgroup limits|‚úÖ|–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –Ω–æ –Ω–µ —Å—Ç—Ä–æ–≥–æ|

---

**üõ† –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç)**

```
if [ -f /.dockerenv ] || grep -qa 'docker\|kubepods' /proc/1/cgroup; then
    echo "Running inside a container"
else
    echo "Not in container"
fi
```

### –í —á–µ–º –æ—Ç–ª–∏—á–∏–µ CMD –∏ ENTRYPOINT

–≠—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Dockerfile –∑–∞–¥–∞—é—Ç –∫–æ–º–∞–Ω–¥—É, –∏—Å–ø–æ–ª–Ω—è–µ–º—É—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ü—Ä–∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö, CMD –∏–ª–∏ ENTRYPOINT, –≤ Dockerfile.
- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª ‚Äî ENTRYPOINT –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.
- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ ‚Äî CMD –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è RUN –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –Ω–µ–≥–æ –ø–∞–∫–µ—Ç—ã. –û–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ–≤–µ—Ä—Ö —Ç–µ–∫—É—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Å–ª–æ–π, —Ñ–∏–∫—Å–∏—Ä—É—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ß–∞—Å—Ç–æ –≤ Dockerfile –≤—ã –Ω–∞–π–¥–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π RUN.

–•–æ—Ä–æ—à–µ–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ RUN –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π:

```
RUN apt-get update && apt-get install -y \
  bzr \
  cvs \
  git \
  mercurial \
  subversion
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ¬†`apt-get update`–∏¬†`apt-get install`–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ RUN. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–∞–º—ã–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–∞–∫–µ—Ç—ã. –ï—Å–ª–∏ –±—ã¬†`apt-get install`—ç—Ç–æ –±—ã–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è RUN, —Ç–æ –æ–Ω–∞ –±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Å–ª–æ–π, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π¬†`apt-get update`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –¥–∞–≤–Ω—ã–º-–¥–∞–≤–Ω–æ.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è CMD –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –ø–æ¬†_—É–º–æ–ª—á–∞–Ω–∏—é_¬†, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π, –∫–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ï—Å–ª–∏ Dockerfile —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ CMD, –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ CMD, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π, –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

CMD –∏–º–µ–µ—Ç —Ç—Ä–∏ —Ñ–æ—Ä–º—ã:

- `CMD ["executable","param1","param2"]`
	
	(–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ)
	
- `CMD ["param1","param2"]`_exec_
	
	(—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è ENTRYPOINT –≤ —Ñ–æ—Ä–º–µ
	
- `CMD command param1 param2`
	
	(—Ñ–æ—Ä–º–∞ –æ–±–æ–ª–æ—á–∫–∏)
	
	`docker run -it <image> /bin/bash`¬†- —Ç—É—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ CMD –æ–Ω –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω, –∏ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –±–∞—à
	
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ENTRYPOINT –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª. –û–Ω –ø–æ—Ö–æ–∂ –Ω–∞ CMD, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –†–∞–∑–Ω–∏—Ü–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ ENTRYPOINT –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏. (–ï—Å—Ç—å —Å–ø–æ—Å–æ–± –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å ENTTRYPOINT, –Ω–æ –≤—Ä—è–¥ –ª–∏ –≤—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç–µ.)


–î–æ–∫–µ—Ä—Ñ–∞–π–ª

```
ENTRYPOINT ["/bin/echo", "Hello"]
CMD ["world"]
```

–∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –∫–∞–∫¬†`docker run -it <image>`–±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –≤—ã–≤–æ–¥

```
Hello world

```

–Ω–æ –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è,¬†`docker run -it <image> John`—ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫

```
Hello John
```

- –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç

cmd –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ entrypoint –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –¢–µ–º —Å–∞–º—ã–º –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–¢–æ –µ—Å—Ç—å –≤ entrypoint –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –±–∏–Ω–∞—Ä—å, –∞ –≤ cmd –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

CMD –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ç–µ—Ä–µ—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ.

### –ß—Ç–æ —Ç–∞–∫–æ–µ Docker? –ö–∞–∫ –æ–Ω —É—Å—Ç—Ä–æ–µ–Ω? –ù–∞ –∫–∞–∫–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è?

Docker ‚Äî —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ).

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- cgroups –∏ namespaces (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- union —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (OverlayFS)
- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫ containerd/runc

### –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker:
- **pid** ‚Äî –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **net** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **ipc** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IPC-—Ä–µ—Å—É—Ä—Å–∞–º–∏ (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
- **mnt** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **uts** ‚Äî –∏–º—è —Ö–æ—Å—Ç–∞ –∏ –¥–æ–º–µ–Ω–∞ (hostname)

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Docker –∏ VMware

- Docker ‚Äî —É—Ä–æ–≤–µ–Ω—å –û–° (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ —Ö–æ—Å—Ç–∞, –±—ã—Å—Ç—Ä–∞—è –∏ –ª—ë–≥–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è)
- VMware ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥–∞—è –í–ú ‚Äî —Å–≤–æ—è –û–°, –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–æ)

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Docker? –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞–µ—Ç?

- –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É "—Ä–∞–±–æ—Ç–∞–µ—Ç —É –º–µ–Ω—è, –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —É —Ç–µ–±—è"
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é —Å—Ä–µ–¥—É
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã Dockerfile

- `FROM` ‚Äî –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
- `RUN` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- `COPY` / `ADD` ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `CMD` / `ENTRYPOINT` ‚Äî –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
- `EXPOSE` ‚Äî –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–æ–≤
- `ENV` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `WORKDIR` ‚Äî —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Dockerfile –∏ docker-compose

- **Dockerfile** ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞
- **docker-compose.yml** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –º–Ω–æ–≥–æ–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã, —Å–µ—Ç–∏, —Ç–æ–º–∞)

### –ö–∞–∫ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ docker image —Å –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã –Ω–∞ –¥—Ä—É–≥—É—é –±–µ–∑ registry?

```bash
docker save myimage > image.tar
scp image.tar user@remote:/tmp/
docker load < image.tar
```
–ò–ª–∏:
```bash
docker export <container> > file.tar
# –∏ –¥–∞–ª–µ–µ docker import
```

### Best practices –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é Dockerfile –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `alpine`)
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–æ–≤
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å root –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤
- –£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `USER` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç—É (AppArmor, seccomp, read-only FS)

### –°–µ—Ç–µ–≤—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã Docker

- **bridge** ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è —Å–µ—Ç—å, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏, –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π bridge-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **host** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫ —Ö–æ—Å—Ç–∞
- **macvlan** ‚Äî –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π MAC-–∞–¥—Ä–µ—Å, –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏
- **overlay** ‚Äî —Å–µ—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ö–æ—Å—Ç–∞–º–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Swarm)
- **swarm** ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–Ω–∞—è —Å–µ—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ Swarm-—Ä–µ–∂–∏–º–µ

### –í —á–µ–º –æ—Ç–ª–∏—á–∏–µ ARG –æ—Ç ENV?

**ENV**¬†–ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**ARG**¬†–ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫–∏–Ω—É—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏. –ù–æ –æ–Ω–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –û–¥–Ω–∞–∫–æ —á–µ—Ä–µ–∑¬†`ARG`¬†–º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è¬†`ENV`


### üß± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–ª–æ–∏ –≤ Docker

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É (Union FS)** ‚Äî —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π RUN, COPY, ADD —Å–æ–∑–¥–∞—ë—Ç **–æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π**, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö.

**‚úîÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

‚Ä¢ –ö–∞–∂–¥—ã–π —Å–ª–æ–π **–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π (immutable)**.
‚Ä¢ –ù–æ–≤—ã–π —Å–ª–æ–π **—Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ** –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∞–π–ª—ã.
‚Ä¢ –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—Ä–∞–∑ ‚Äî —ç—Ç–æ **stack —Å–ª–æ—ë–≤**:

```
FROM python:3.10      # –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π
RUN apt install curl  # + –Ω–æ–≤—ã–π —Å–ª–æ–π —Å curl
COPY . /app           # + —Å–ª–æ–π —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
```
---

**üîó –ì–¥–µ —Ç—É—Ç —Ö–∞—Ä–¥–ª–∏–Ω–∫–∏ –∏ —Å–∏–º–ª–∏–Ω–∫–∏?**

**‚öôÔ∏è –ü—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞:**

‚Ä¢ Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **copy-on-write** –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å **—Ö–∞—Ä–¥–ª–∏–Ω–∫–∏** –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö–æ—Å—Ç–æ–≤–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, OverlayFS).

‚Ä¢ –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç **—ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–∏—Å–∫** ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã **–Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è**, –∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ inode.

---
**üß∑ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ö–∞—Ä–¥–ª–∏–Ω–∫–∞–º–∏ –∏ —Å–∏–º–ª–∏–Ω–∫–∞–º–∏:**

|**–¢–∏–ø —Å—Å—ã–ª–∫–∏**|**–•–∞—Ä–¥–ª–∏–Ω–∫**|**–°–∏–º–ª–∏–Ω–∫**|
|---|---|---|
|–ß—Ç–æ —Å—Å—ã–ª–∞–µ—Ç—Å—è|–ù–∞ inode (—Å–∞–º —Ñ–∞–π–ª)|–ù–∞ –ø—É—Ç—å (–∏–º—è —Ñ–∞–π–ª–∞)|
|–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–∞|–§–∞–π–ª –æ—Å—Ç–∞—ë—Ç—Å—è|–°—Å—ã–ª–∫–∞ ‚Äú–±–∏—Ç–∞—è‚Äù|
|–í–∏–¥–Ω–∞ –≤ ls -li|–î–∞, –∏–º–µ–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π inode|–ù–µ—Ç, —Å–≤–æ–π inode|
|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Docker|–î–∞, –Ω–æ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ**, –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ—ë–≤|–ò–Ω–æ–≥–¥–∞ –≤ COPY –∏–ª–∏ –≤—Ä—É—á–Ω—É—é|

---

**üìÅ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏–º–ª–∏–Ω–∫–æ–≤ –≤ Docker**

```
RUN ln -s /usr/bin/python3 /usr/bin/python
```

‚Ä¢ –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–∏–º–ª–∏–Ω–∫ –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞.

‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø—É—Ç—å, –Ω–æ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞.

---
#### üß† –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

–¢—ã –º–æ–∂–µ—à—å —Å–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

> Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∏—Å—Ç—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–æ–π —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤. –ù–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã, Docker –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–∞—Ä–¥–ª–∏–Ω–∫–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏, —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–∏—Å–∫ –∏ —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É. –°–∏–º–ª–∏–Ω–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–æ–≤, –Ω–æ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∫—ç—à —Å–ª–æ—ë–≤ –Ω–∞–ø—Ä—è–º—É—é.

---

**üí° –•–∏–Ω—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

  

–ß—Ç–æ–±—ã **–∫—ç—à Docker —Ä–∞–±–æ—Ç–∞–ª —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**, –Ω—É–∂–Ω–æ:

‚Ä¢ –°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt) ‚Üí –ø–æ—Ç–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∏.

‚Ä¢ –û–±—ä–µ–¥–∏–Ω—è—Ç—å RUN-–∫–æ–º–∞–Ω–¥—ã.

‚Ä¢ –£–¥–∞–ª—è—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ—è.

  

–•–æ—á–µ—à—å, –ø–æ–∫–∞–∂—É –ø—Ä–∏–º–µ—Ä Dockerfile –¥–æ –∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º —Å–ª–æ—ë–≤ –∏ –∫—ç—à–∞?

---

## Bash

### –û–±—Ä–∞–±–æ—Ç–∫–∞ access –ª–æ–≥–æ–≤ (CSV): timestamp, status, url, user-agent

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö URL:
```bash
cut -d',' -f3 access.csv | sort | uniq | wc -l
```

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π URL:
```bash
cut -d',' -f3 access.csv | sort | uniq -c | sort -nr
```

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 400-404 –ø–æ –∫–∞–∂–¥–æ–º—É URL:
```bash
awk -F',' '$2 ~ /^40[0-4]$/ {print $3}' access.csv | sort | uniq -c | sort -nr
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `set -eu -o pipefail`?

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ bash-—Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏:
- `set -e` ‚Äî –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –ª—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π.
- `set -u` ‚Äî –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–æ–±—ä—è–≤–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è.
- `set -o pipefail` ‚Äî –µ—Å–ª–∏ –æ–¥–Ω–∞ –∏–∑ –∫–æ–º–∞–Ω–¥ –≤ –ø–∞–π–ø–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π, —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.
- `set -x` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ) ‚Äî –≤—ã–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—ã –≤ stdout –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).

### –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–æ–º–∞–Ω–¥—É –Ω–∞ 50 —Å–µ—Ä–≤–µ—Ä–∞—Ö?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- –° –ø–æ–º–æ—â—å—é `ssh` –≤ —Ü–∏–∫–ª–µ:
```bash
for host in $(cat hosts.txt); do
  ssh user@$host '–∫–æ–º–∞–Ω–¥–∞' &
done
wait
```

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pssh` (parallel-ssh):
```bash
pssh -h hosts.txt -l user -i '–∫–æ–º–∞–Ω–¥–∞'
```

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ansible:
```bash
ansible all -i hosts.ini -m shell -a '–∫–æ–º–∞–Ω–¥–∞'
```

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tmux`, `dsh`, `fabric` –∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–∞—Å—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.


## –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã?
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
- –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### Nginx

#### –û—à–∏–±–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º
- **5xx** ‚Äî –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 500)
- **4xx** ‚Äî –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 400, 404, 413 ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞)

#### HTTP-–º–µ—Ç–æ–¥—ã, –∏–∑–º–µ–Ω—è—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `POST`, `PUT`, `DELETE`

#### –ö–∞–∫ Nginx —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É C10K?

–ó–∞ —Å—á—ë—Ç —Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –º–æ–¥–µ–ª—å
- master + –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–∞—è –º–æ–¥–µ–ª—å workers
- –∫–∞–∂–¥—ã–π worker ‚Äî –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Apache)

#### –í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```nginx
worker_processes auto;
worker_connections 1024;
# max_clients = worker_processes * worker_connections
```

#### –ö–∞–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è location?
–ü–æ—Ä—è–¥–æ–∫:
1. `=` ‚Äî —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
2. `^~` ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å
3. `~` / `~*` ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (—É—á–∏—Ç—ã–≤–∞–µ—Ç/–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä)
4. –ë–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

#### –ö–∞–∫ –¥–µ–±–∞–∂–∏—Ç—å location?
- –õ–æ–≥–∏: `access.log`, `error.log`
- –í—Ä–µ–º–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `return`, `add_header`
- –ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ URI –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º–æ–≥–æ –ø—É—Ç–∏

#### –ß—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ `localhost:3000`) —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π URL –∑–∞–ø—Ä–æ—Å–∞, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø—É—Ç—å (`X-Forwarded-For`, `X-Real-IP`, `Host`)

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Nginx –ø–µ—Ä–µ–¥ Apache
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ—Ç–¥–∞—á–µ —Å—Ç–∞—Ç–∏–∫–∏ (x2.5)
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (event loop –ø—Ä–æ—Ç–∏–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
- –ú–µ–Ω—å—à–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ frontend –ø—Ä–æ–∫—Å–∏ –∫ Apache/php-fpm –∏ –¥—Ä.

#### –ú–æ–≥—É—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ?
–î–∞. –ü—Ä–∏–º–µ—Ä —Å–≤—è–∑–∫–∏:
- Nginx ‚Äî —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –æ—Ç–¥–∞–µ—Ç —Å—Ç–∞—Ç–∏–∫—É, –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç
- Apache ‚Äî –±—ç–∫–µ–Ω–¥, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É

### HAProxy
- –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π L4/L7-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TCP –∏ HTTP
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ACL, health checks, sticky sessions
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±–∞–ª–∞–Ω—Å–µ—Ä

### Envoy
- –ü—Ä–æ–∫—Å–∏ –∏ —Å–µ—Ä–≤–∏—Å-–º–µ—à –æ—Ç Lyft
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTTP/2, gRPC, TLS termination
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Istio
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### Google Cloud Load Balancer
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ L4 –∏ L7
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Anycast IP
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Cloud CDN, Cloud Armor
- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ GCP Console –∏–ª–∏ `gcloud`

### AWS Load Balancers

#### Classic Load Balancer (CLB)
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–π, L4/L7

#### Application Load Balancer (ALB)
- L7 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (HTTP/HTTPS)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ path-based, host-based routing

#### Network Load Balancer (NLB)
- L4 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (TCP/UDP)
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

–û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å Auto Scaling –∏ ECS/EKS

## –ü—Ä–æ–∫—Å–∏ vs –†–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–∫—Å–∏ (forward proxy)?

–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–µ–π—Å—Ç–≤—É–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞:
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –∫ —Ü–µ–ª–µ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É, –∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏.
- –ü—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.
- –ü—Ä–∏–º–µ—Ä: —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ñ–∏—Å–∞ –≤—ã—Ö–æ–¥–∏—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä.

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –ö–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–∏
- –û–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ (reverse proxy)?

–†–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞:
- –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–¥–∏–Ω –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å.
- –†–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –æ–¥–Ω–æ–º—É –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.
- –û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É –æ—Ç –∏–º–µ–Ω–∏ –ø—Ä–æ–∫—Å–∏.

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- SSL termination
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞        | –ü—Ä–æ–∫—Å–∏                     | –†–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏               |
|------------------------|----------------------------|-----------------------------|
| –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–≥–æ?     | –û—Ç –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞           | –û—Ç –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞            |
| –ö—Ç–æ –∑–Ω–∞–µ—Ç –æ –Ω—ë–º?       | –ö–ª–∏–µ–Ω—Ç                     | –°–µ—Ä–≤–µ—Ä (–∞ –∫–ª–∏–µ–Ω—Ç ‚Äî –Ω–µ—Ç)     |
| –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞        | –î–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º  | –ó–∞—â–∏—Ç–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º |
| –ü—Ä–∏–º–µ—Ä                 | Squid                      | Nginx, HAProxy, Envoy       |
## Kubernetes

### **Architecture**

Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: **Control Plane** (–ø–ª–æ—Å–∫–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è) –∏ **Worker Nodes** (—Ä–∞–±–æ—á–∏–µ —É–∑–ª—ã). –≠—Ç–∏ —á–∞—Å—Ç–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤.

- **Control Plane** ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º. –û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ Pod‚Äô–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Äî –∂–µ–ª–∞–µ–º–æ–º—É. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
	- **kube-apiserver** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ REST-–∑–∞–ø—Ä–æ—Å—ã (kubectl, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ —Ç.–¥.), –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ API.
	- **etcd** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤—Å—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞: –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Å–µ–∫—Ä–µ—Ç—ã –∏ –¥—Ä.
	- **kube-scheduler** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω–∞ –∫–∞–∫–∏–µ –Ω–æ–¥—ã —Ä–∞–∑–º–µ—â–∞—Ç—å –Ω–æ–≤—ã–µ Pod‚Äô—ã, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö –∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö.
	- **kube-controller-manager** ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ (Deployment, ReplicaSet, Node –∏ –¥—Ä.), —Å–ª–µ–¥—è –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∂–µ–ª–∞–µ–º–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.
	- _(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)_ **cloud-controller-manager** ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å API –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, AWS –∏–ª–∏ GCP), —É–ø—Ä–∞–≤–ª—è—è —Ç–∞–∫–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∫–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏, –º–∞—Ä—à—Ä—É—Ç—ã –∏ –¥–∏—Å–∫–∏.

- **Worker Nodes** ‚Äî —ç—Ç–æ —É–∑–ª—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ö–∞–∂–¥—ã–π node –≤–∫–ª—é—á–∞–µ—Ç:
    - **kubelet** ‚Äî –∞–≥–µ–Ω—Ç, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–π —Å API Server –∏ –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –∑–∞–ø—É—Å–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Pod‚Äô–æ–≤ –Ω–∞ —É–∑–ª–µ.
    - **container runtime** (–Ω–∞–ø—Ä–∏–º–µ—Ä, containerd, cri-o) ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∑–∞–ø—É—Å–∫–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
    - **kube-proxy** ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É Pod‚Äô–∞–º–∏ –∏ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—è –ø—Ä–∞–≤–∏–ª–∞ iptables/ipvs.
  
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, **Control Plane** —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∫–∞–∫ —Å–∏—Å—Ç–µ–º–æ–π, –∞ **Worker Nodes** –∏—Å–ø–æ–ª–Ω—è—é—Ç —Ä–∞–±–æ—á–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã), –ø–æ–¥—á–∏–Ω—è—è—Å—å —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –∏ —Ä–µ—à–µ–Ω–∏—è–º.

---
#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ `kubectl apply`

1. üí¨ –ö–ª–∏–µ–Ω—Ç `kubectl` —Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç:

   ```bash
   kubectl apply -f my-deployment.yaml
   ```

   –°—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è YAML-—Ñ–∞–π–ª, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Deployment, Service –∏ —Ç.–¥.)

2. üì§ `kubectl` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ API Server:

   –ú–∞–Ω–∏—Ñ–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å –∫ **API Server** ‚Äî —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤ Kubernetes.

3. üîç API Server —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∏ –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

   - API Server –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ –≤ `etcd` (—á–µ—Ä–µ–∑ —Å–≤–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ª–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è).
   - –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç **—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **\"patch\"** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ), —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç–∞ **–µ—â—ë –Ω–µ—Ç** ‚Äî –æ–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –Ω—É–ª—è.

   > `kubectl apply` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **\"server-side apply\"** –∏–ª–∏ **\"client-side apply\"** (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏ –∏ —Ñ–ª–∞–≥–æ–≤) ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –≤—ã—á–∏—Å–ª–∏—Ç—å, –∫–∞–∫–∏–µ –ø–æ–ª—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å.

4. üì¶ `etcd` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

   API Server —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ **etcd** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π key-value –±–∞–∑–µ.

5. ‚öôÔ∏è –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–∏–≤–æ–¥—è—Ç –∫–ª–∞—Å—Ç–µ—Ä –∫ –Ω—É–∂–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é:

   –ï—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—ë–Ω –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ `Deployment`:
   - **Deployment Controller** –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –°–æ–∑–¥–∞—ë—Ç –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç **ReplicaSet**.
   - ReplicaSet —Å–æ–∑–¥–∞—ë—Ç –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç **Pod'—ã**.

6. üîÅ Scheduler —Ä–∞–∑–º–µ—â–∞–µ—Ç –Ω–æ–≤—ã–µ Pod'—ã:

   –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ Pod'—ã:
   - **Scheduler** –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π **Worker Node**.
   - –ù–∞–∑–Ω–∞—á–∞–µ—Ç Pod –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É–∑–µ–ª.

7. üß© Kubelet –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

   –ù–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –Ω–æ–¥–µ:
   - **Kubelet** –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç API Server.
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ **Container Runtime** (–Ω–∞–ø—Ä–∏–º–µ—Ä, containerd, cri-o, Docker).

8. üåê Kube Proxy –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ—Ç—å:

   –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–µ—Ä–≤–∏—Å –∏–ª–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ —Å–µ—Ç–∏:
   - **Kube Proxy** –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (iptables/ipvs).
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Pod'–∞–º –ø–æ —Å–µ—Ä–≤–∏—Å—É.

### QOS (Pod Quality of Service Classes)

QoS-–∫–ª–∞—Å—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç Pod‚Äô–∞ –ø—Ä–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–∏ (eviction), –∞ —Ç–∞–∫–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –¥–∞–≤–ª–µ–Ω–∏—è –ø–æ CPU/–ø–∞–º—è—Ç–∏.
(QoS) –≤ Kubernetes ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –∫–∞–∫ kubelet —É–ø—Ä–∞–≤–ª—è–µ—Ç Pod-–∞–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤.

–í Kubernetes –µ—Å—Ç—å **—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ QoS**:
#### 1. Guaranteed

‚úÖ **–ù–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—á–µ—Ä–µ–¥—å.**

**–£—Å–ª–æ–≤–∏—è:**

‚Ä¢ **–î–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ Pod-–µ –∑–∞–¥–∞–Ω—ã requests –∏ limits, –∏ –æ–Ω–∏ —Ä–∞–≤–Ω—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É.**

```
resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "512Mi"
    cpu: "500m"
```

> –¢–∞–∫–æ–π Pod –ø–æ–ª—É—á–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –∑–∞—â–∏—â—ë–Ω –æ—Ç –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø—Ä–∏ OOM (Out of Memory) –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ.

#### 2. Burstable

‚ö†Ô∏è **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.**

**–£—Å–ª–æ–≤–∏—è:**

‚Ä¢ –£ **–Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** –∑–∞–¥–∞–Ω—ã requests, –∏:

‚Ä¢ –ª–∏–±–æ –æ–Ω–∏ **–Ω–µ —Ä–∞–≤–Ω—ã limits**,

‚Ä¢ –ª–∏–±–æ limits –Ω–µ –∑–∞–¥–∞–Ω—ã –≤–æ–≤—Å–µ.

```
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"
    cpu: "1"
```

> –¢–∞–∫–æ–π Pod –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º (requests), –Ω–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ —É–∑–ª–µ.

---

#### 3. BestEffort

‚ùå **–ù–∞–∏–º–µ–Ω—å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º.**

**–£—Å–ª–æ–≤–∏—è:**

‚Ä¢ –£ **–Ω–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ—Ç requests –∏ limits**.

```
resources: {}
```

> –≠—Ç–æ—Ç Pod —Ä–∞–±–æ—Ç–∞–µ—Ç ¬´–Ω–∞ —É–¥–∞—á—É¬ª ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —É–∑–ª–µ. –û–Ω –ø–µ—Ä–≤—ã–º –ø–æ–ø–∞–¥–∞–µ—Ç –ø–æ–¥ OOM killer.

---

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å QoS –∫–ª–∞—Å—Å —É —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ Pod?**

```
kubectl get pod <pod-name> -o jsonpath='{.status.qosClass}'
```


### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–µ–¥—É–ª–∏–Ω–≥–æ–º –≤ Kubernetes: Tolerations, Affinity, Labels –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ Pod'–æ–≤ –Ω–∞ –Ω–æ–¥—ã

–í Kubernetes –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ Pod'–æ–≤ –Ω–∞ –Ω–æ–¥—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ **scheduler**. –ß—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **labels**, **tolerations**, **taints**, **node affinity**, **pod affinity/anti-affinity**.

#### 1. Labels (–ª–µ–π–±–ª—ã)

**–õ–µ–π–±–ª—ã** ‚Äî —ç—Ç–æ –ø–∞—Ä—ã –∫–ª—é—á/–∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∫–∞–∫ Pod'–∞–º, —Ç–∞–∫ –∏ –Ω–æ–¥–∞–º. –û–Ω–∏ —Å–ª—É–∂–∞—Ç –æ—Å–Ω–æ–≤–æ–π –¥–ª—è:
- –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –Ω–æ–¥ (—á–µ—Ä–µ–∑ `nodeAffinity`);
- –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ `kubectl get pods -l app=frontend`);
- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å–µ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É Pod'–∞–º–∏ (`podAffinity`, `antiAffinity`);
- –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ (`selector`).

```yaml
metadata:
  labels:
    app: \"frontend\"
    disktype: \"ssd\"
```

#### 2. Taints –∏ Tolerations

- **Taint** ‚Äî —ç—Ç–æ –º–µ—Ç–∫–∞ –Ω–∞ –Ω–æ–¥–µ, –∫–æ—Ç–æ—Ä–∞—è **–Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç** —Ä–∞–∑–º–µ—â–∞—Ç—å –Ω–∞ –Ω–µ–π Pod'—ã, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —É Pod'–∞ –Ω–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π **toleration**.
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –Ω–æ–¥, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPU-–Ω–æ–¥—ã –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ).

```bash
kubectl taint nodes my-node key=value:NoSchedule
```

- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –Ω–µ —Ä–∞–∑–º–µ—â–∞–π Pod'—ã –Ω–∞ `my-node`, –µ—Å–ª–∏ —É –Ω–∏—Ö –Ω–µ—Ç `toleration` –¥–ª—è `key=value`.

**–ü—Ä–∏–º–µ—Ä Toleration –≤ Pod-–º–∞–Ω–∏—Ñ–µ—Å—Ç–µ:**

```yaml
tolerations:
  - key: \"key\"
    operator: \"Equal\"
    value: \"value\"
    effect: \"NoSchedule\"
```

#### 3. Node Affinity

–ü–æ–∑–≤–æ–ª—è–µ—Ç **–ø—Ä–µ–¥–ø–æ—á–µ—Å—Ç—å** –∏–ª–∏ **—Ç—Ä–µ–±–æ–≤–∞—Ç—å** —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ Pod'–∞ –Ω–∞ –Ω–æ–¥–µ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –ª–µ–π–±–ª–∞–º–∏.

**–¢–∏–ø—ã Node Affinity:**
- `requiredDuringSchedulingIgnoredDuringExecution` ‚Äî **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ** —É—Å–ª–æ–≤–∏–µ.
- `preferredDuringSchedulingIgnoredDuringExecution` ‚Äî **–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–µ**, –Ω–æ –Ω–µ —Å—Ç—Ä–æ–≥–æ–µ.

**–ü—Ä–∏–º–µ—Ä:**

```yaml
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: \"disktype\"
              operator: \"In\"
              values:
                - \"ssd\"
```

> –≠—Ç–æ—Ç Pod –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–º–µ—â—ë–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–æ–¥–∞—Ö —Å –º–µ—Ç–∫–æ–π `disktype=ssd`.

#### 4. Pod Affinity / Anti-Affinity

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º, **—Ä—è–¥–æ–º —Å –∫–∞–∫–∏–º–∏ Pod'–∞–º–∏** –º–æ–∂–µ—Ç (–∏–ª–∏ –Ω–µ –º–æ–∂–µ—Ç) –±—ã—Ç—å —Ä–∞–∑–º–µ—â—ë–Ω –Ω–æ–≤—ã–π Pod. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–µ–π–±–ª—ã –¥—Ä—É–≥–∏—Ö Pod'–æ–≤.

##### Pod Affinity (—Å–æ—Å–µ–¥—Å—Ç–≤–æ):

```yaml
affinity:
  podAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: \"app\"
              operator: \"In\"
              values:
                - \"frontend\"
        topologyKey: \"kubernetes.io/hostname\"
```

> –ü–æ–¥ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â—ë–Ω –Ω–∞ —Ç–æ–π –∂–µ –Ω–æ–¥–µ, –≥–¥–µ —É–∂–µ –µ—Å—Ç—å Pod —Å –º–µ—Ç–∫–æ–π `app=frontend`.

##### Pod Anti-Affinity (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ):

```yaml
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: \"app\"
              operator: \"In\"
              values:
                - \"frontend\"
        topologyKey: \"kubernetes.io/hostname\"
```

> –ü–æ–¥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â—ë–Ω –Ω–∞ —Ç–æ–π –∂–µ –Ω–æ–¥–µ, –≥–¥–µ —É–∂–µ –µ—Å—Ç—å –¥—Ä—É–≥–æ–π `frontend` Pod.

Kubernetes –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–∏–±–∫–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º Pod'–æ–≤:
- **Labels** ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
- **Taints/Tolerations** ‚Äî –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–∫–ª—é—á–∞—Ç—å –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–µ –Ω–æ–¥—ã.
- **Affinity/Anti-Affinity** ‚Äî –¥–∞—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –ø–æ –Ω–æ–¥–∞–º –∏ –¥—Ä—É–≥–∏–º Pod'–∞–º.

–ì—Ä–∞–º–æ—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∏—Ç—å—Å—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞.

### Pod Lifecycle

–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª Pod-–∞. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫ Pod-—ã —Å–æ–∑–¥–∞—é—Ç—Å—è, –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏, –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –∏ —É–¥–∞–ª—è—é—Ç—Å—è.

#### **üö¶ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª Pod-–∞**

##### **üìå –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (PodPhase):**

–≠—Ç–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å—Ç–∞–¥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —á–µ—Ä–µ–∑ kubectl get pod.

1. **Pending** ‚Äî Pod –±—ã–ª –ø—Ä–∏–Ω—è—Ç API —Å–µ—Ä–≤–µ—Ä–æ–º, –Ω–æ **–µ—â—ë –Ω–µ –∑–∞–ø—É—â–µ–Ω** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∂–¥—ë—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –Ω–æ–¥–µ).
2. **Running** ‚Äî —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω, –∏ Pod —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–µ—â—ë–Ω.
3. **Succeeded** ‚Äî –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ (—Å –∫–æ–¥–æ–º 0), –∏ Pod –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è.
4. **Failed** ‚Äî —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª—Å—è **–Ω–µ—É—Å–ø–µ—à–Ω–æ**, –∏ Pod –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.
5. **Unknown** ‚Äî kubelet **–Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å** —Å—Ç–∞—Ç—É—Å (–æ–±—ã—á–Ω–æ –∏–∑-–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º).

---
##### **üìå –°–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (ContainerState)**

–ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω—É—Ç—Ä–∏ Pod-–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤:

‚Ä¢ **Waiting** ‚Äî –æ–∂–∏–¥–∞–µ—Ç –∑–∞–ø—É—Å–∫–∞. –ü—Ä–∏—á–∏–Ω—ã –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ .state.waiting.reason (–Ω–∞–ø—Ä–∏–º–µ—Ä, CrashLoopBackOff, ImagePullBackOff).

‚Ä¢ **Running** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω.

‚Ä¢ **Terminated** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ø–æ exit code –∏–ª–∏ —Å–∏–≥–Ω–∞–ª—É).

–ü—Ä–∏–º–µ—Ä:

```
kubectl get pod mypod -o jsonpath='{.status.containerStatuses[*].state}'
```

---

#### üîÅ Restart Policy

–£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ Pod-–∞. –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

‚Ä¢ Always (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Deployment)

‚Ä¢ OnFailure (–¥–ª—è Job)

‚Ä¢ Never

> –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –±—É–¥–µ—Ç –ª–∏ kubelet –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ —Å–±–æ–µ.

---

**üîÑ Container Lifecycle Hooks**

–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π:

```
lifecycle:
  postStart:
    exec:
      command: ["/bin/sh", "-c", "echo Hello from postStart"]
  preStop:
    exec:
      command: ["/bin/sh", "-c", "echo Goodbye from preStop"]
```

‚Ä¢ **postStart** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**, –Ω–æ –¥–æ –µ–≥–æ marked as Running.
‚Ä¢ **preStop** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ kubectl delete pod –∏–ª–∏ Scale down).

---

#### ‚è± Termination Grace Period

‚Ä¢ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **30 —Å–µ–∫—É–Ω–¥**.

‚Ä¢ Kubernetes –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SIGTERM, –∂–¥—ë—Ç terminationGracePeriodSeconds, –∑–∞—Ç–µ–º ‚Äî SIGKILL.

```
terminationGracePeriodSeconds: 10
```
---

**üìâ Final Pod Termination Flow**

1. kubelet –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SIGTERM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º.
2. –ñ–¥—ë—Ç terminationGracePeriodSeconds.
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è preStop hook (–µ—Å–ª–∏ –µ—Å—Ç—å).
4. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî SIGKILL.
5. Pod —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ etcd (–µ—Å–ª–∏ –±–µ–∑ finalizer).

### preStop && finalizer

–ò–Ω–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ—Ö–æ–∂–∏–µ –∑–∞–¥–∞—á–∏ (—á—Ç–æ-—Ç–æ ‚Äú–ø–æ—á–∏—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º‚Äù), –Ω–æ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ-—á–µ—Å—Ç–Ω–æ–º—É, –±–µ–∑ –≤–æ–¥—ã:

---

**üîÅ –ö—Ä–∞—Ç–∫–æ: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É preStop –∏ finalizer**

||**preStop hook**|**finalizer**|
|---|---|---|
|**–£—Ä–æ–≤–µ–Ω—å**|–£—Ä–æ–≤–µ–Ω—å **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** –≤–Ω—É—Ç—Ä–∏ Pod-–∞|–£—Ä–æ–≤–µ–Ω—å **Kubernetes-–æ–±—ä–µ–∫—Ç–∞** (Pod, PVC, CRD –∏ —Ç.–ø.)|
|**–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è**|–ü–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, SIGTERM)|–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞, **–Ω–æ –¥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è**|
|**–ö—Ç–æ –∏—Å–ø–æ–ª–Ω—è–µ—Ç**|**kubelet** –Ω–∞ –Ω–æ–¥–µ|–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–≤–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä/–≤–Ω–µ—à–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å)|
|**–î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω**|–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ (–Ω–∞–ø—Ä., –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)|–í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É: —É–¥–∞–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å–≤—è–∑–∏|
|**–ú–æ–∂–Ω–æ –ª–∏ ‚Äú–∑–∞–≤–∏—Å–Ω—É—Ç—å‚Äù**|–ù–µ—Ç ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω terminationGracePeriod|–î–∞ ‚Äî –ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–∏—à—å finalizer, –æ–±—ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è|
|**–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ kill -9?**|‚ùå –ù–µ—Ç ‚Äî SIGKILL –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç preStop|‚úÖ –î–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ finalizer –≤—ã—à–µ –ø–æ —É—Ä–æ–≤–Ω—é|

---

#### üîç –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**preStop:**

‚Ä¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ 100 –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É. preStop –º–æ–∂–µ—Ç:

‚Ä¢ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é: ¬´–∑–∞–≤–µ—Ä—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è¬ª;

‚Ä¢ –¥–æ–∂–¥–∞—Ç—å—Å—è 10 —Å–µ–∫—É–Ω–¥;

‚Ä¢ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å–∞–º.

```
lifecycle:
  preStop:
    exec:
      command: ["/bin/sh", "-c", "echo 'shutting down' >> /log"]
```

> –≠—Ç–æ **–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ**, –∫–∞–∫ —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞.

---

**finalizer:**

‚Ä¢ –£ —Ç–µ–±—è Pod, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –≤–Ω–µ—à–Ω–µ–π –ë–î**, **–æ—Å–≤–æ–±–æ–¥–∏—Ç—å IP-–∞–¥—Ä–µ—Å**, **—É–≤–µ–¥–æ–º–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**.

‚Ä¢ –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è —Å–¥–µ–ª–∞—Ç—å –∏–∑–Ω—É—Ç—Ä–∏ Pod-–∞, —Ç—ã —Ö–æ—á–µ—à—å –¥–µ–ª–∞—Ç—å —ç—Ç–æ **–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ**.

```
metadata:
  finalizers:
    - cleanup.mycompany.com
```

> –ü–æ–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ —É–±–µ—Ä—ë—Ç —ç—Ç–æ—Ç finalizer ‚Äî Pod –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è.

---

**üéØ –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏**

|**–í–æ–ø—Ä–æ—Å**|**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**|
|---|---|
|–ù—É–∂–Ω–æ **—á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–µ—Ä–µ–¥ –µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π**?|‚úÖ preStop|
|–ù—É–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π —Ä–µ—Å—É—Ä—Å –∏–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ ‚Äú–ø–æ–ø—Ä–æ—â–∞—Ç—å—Å—è‚Äù —Å –æ–±—ä–µ–∫—Ç–æ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∞**?|‚úÖ finalizer|

### ü©∫ Probes

**Probes** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ Kubernetes –≤—ã–ø–æ–ª–Ω—è–µ—Ç, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å:

‚Ä¢ **–∂–∏–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (livenessProbe)**

‚Ä¢ **–≥–æ—Ç–æ–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ (readinessProbe)**

‚Ä¢ **–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (startupProbe)**

–û–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç kubelet –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è:

‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä?

‚Ä¢ –ù–∞—á–∞—Ç—å –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ –Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫?

‚Ä¢ –ü–æ–¥–æ–∂–¥–∞—Ç—å –ª–∏ –ø–æ–¥–æ–ª—å—à–µ, –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç—É–µ—Ç –¥–æ–ª–≥–æ?

---

#### üîç 1. livenessProbe

> **‚Äú–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–∏—Å? –ù–∞–¥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å.‚Äù**

–ï—Å–ª–∏ livenessProbe –Ω–µ—É–¥–∞—á–Ω–∞ ‚Äî **kubelet –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**.

–ü—Ä–∏–º–µ—Ä:

```
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
```

---

#### üïí 2. readinessProbe

> **‚Äú–ì–æ—Ç–æ–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã?‚Äù**

–ï—Å–ª–∏ readinessProbe –Ω–µ—É–¥–∞—á–Ω–∞ ‚Äî Pod **–≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–∑ service endpoints** (–Ω–∞ –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç –∏–¥—Ç–∏ —Ç—Ä–∞—Ñ–∏–∫).

–ü—Ä–∏–º–µ—Ä:

```
readinessProbe:
  exec:
    command: ["cat", "/tmp/ready"]
  initialDelaySeconds: 2
  periodSeconds: 5
```

---
#### üê¢ 3. startupProbe

> **‚Äú–î–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–ø—É—Å–∫ ‚Äî –Ω–µ —É–±–∏–≤–∞–π –µ–≥–æ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.‚Äù**

–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è **–º–µ–¥–ª–µ–Ω–Ω–æ —Å—Ç–∞—Ä—Ç—É—é—â–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**. –î–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ startupProbe **–Ω–µ –ø—Ä–æ—à–ª–∞**, Kubernetes **–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç livenessProbe**. –¢–æ –µ—Å—Ç—å –æ–Ω–∞ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π.

```
startupProbe:
  httpGet:
    path: /startup
    port: 8080
  failureThreshold: 30
  periodSeconds: 10
```

> –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–∞—ë—Ç—Å—è ~5 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–ø—É—Å–∫ (30 √ó 10 —Å–µ–∫—É–Ω–¥).

---

**üîß –¢–∏–ø—ã probe‚Äô–æ–≤:**

‚Ä¢ httpGet ‚Äî –¥–µ–ª–∞–µ—Ç HTTP GET-–∑–∞–ø—Ä–æ—Å –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ (200-399 ‚Äî —É—Å–ø–µ—Ö).

‚Ä¢ exec ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

‚Ä¢ tcpSocket ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç TCP-–ø–æ—Ä—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.

---

**üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ:**

| **–ó–∞–¥–∞—á–∞**                       | **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** |
| -------------------------------- | ---------------- |
| –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≤–∏—Å—à–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | livenessProbe    |
| –£–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫–æ–º –∫ Pod‚Äô—É       | readinessProbe   |
| –î–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫  | startupProbe     |
#### –í –∫–∞–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–æ–±—ã (startupProbe, readinessProbe, livenessProbe)

**‚úÖ –û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**

1. **startupProbe ‚Äî –ø–µ—Ä–≤–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**

‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –≤—Ä–µ–º—è ‚Äú–ø—Ä–æ—Å–Ω—É—Ç—å—Å—è‚Äù (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –¥–æ–ª–≥–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç).

‚Ä¢ –ü–æ–∫–∞ startupProbe –Ω–µ **—É—Å–ø–µ—à–Ω–∞**, **–Ω–∏ liveness, –Ω–∏ readiness –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è**.

‚Ä¢ –ï—Å–ª–∏ startupProbe **–ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è**, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–Ω–µ–∂–∏–≤—ã–º‚Äù –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.

2. **readinessProbe ‚Äî –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ startupProbe**

‚Ä¢ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≥–æ—Ç–æ–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –ë–î, –ø—Ä–æ–≥—Ä–µ–ª –∫—ç—à –∏ —Ç.–¥.).

‚Ä¢ –ü–æ–∫–∞ readinessProbe –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç, **Pod –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤**.

‚Ä¢ –î–∞–∂–µ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä **–∂–∏–≤**, –Ω–æ –Ω–µ –≥–æ—Ç–æ–≤ ‚Äî —Å–µ—Ä–≤–∏—Å –Ω–µ –±—É–¥–µ—Ç –∫ –Ω–µ–º—É –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

3. **livenessProbe ‚Äî —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ startupProbe**

‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, **–∂–∏–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –∑–∞–≤–∏—Å –ª–∏, –Ω–µ —É—Ç—ë–∫ –ª–∏ –≤ –≤–µ—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É).

‚Ä¢ –ï—Å–ª–∏ livenessProbe –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è, **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**.

---

**üìå –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏**

‚Ä¢ –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ startupProbe **–ø—Ä–æ—à–ª–∞**, –æ–Ω–∞ **–±–æ–ª—å—à–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**.

‚Ä¢ readinessProbe –∏ livenessProbe **–ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏** –≤—Å—ë –≤—Ä–µ–º—è, –ø–æ–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–∏–≤.

‚Ä¢ readinessProbe –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å ‚Äú–Ω–µ –≥–æ—Ç–æ–≤‚Äù, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Äî –∏ –≤ —ç—Ç–æ –≤—Ä–µ–º—è —Å–µ—Ä–≤–∏—Å **–ø–µ—Ä–µ—Å—Ç–∞—ë—Ç —Å–ª–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫** –Ω–∞ —ç—Ç–æ—Ç pod.

‚Ä¢ livenessProbe –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å ‚Üí kubelet **—Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**.

---

**üîÅ –¢–∞–π–º–∏–Ω–≥–∏**

–¢—ã –º–æ–∂–µ—à—å –∑–∞–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–±:

‚Ä¢ initialDelaySeconds ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π.

‚Ä¢ periodSeconds ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏.

‚Ä¢ timeoutSeconds ‚Äî —Å–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞.

‚Ä¢ failureThreshold ‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ –¥–æ–ª–∂–Ω–æ –Ω–µ –ø—Ä–æ–π—Ç–∏, —á—Ç–æ–±—ã —Å—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–º.

---

**üß† –ù–∞ —Å–æ–±–µ—Å–µ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å:**

> Kubernetes –∑–∞–ø—É—Å–∫–∞–µ—Ç startupProbe, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É—Å–ø–µ–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ü–æ–∫–∞ –æ–Ω–∞ –Ω–µ –ø—Ä–æ—à–ª–∞, readiness –∏ liveness –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ readinessProbe —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫–æ–º, –∞ livenessProbe —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–æ–≤–∏—Å. –≠—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–≥–∞—Ç—å –ª–∏—à–Ω–∏—Ö —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤ –ø—Ä–∏ –¥–æ–ª–≥–æ–º —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
### InitContainers

initContainer ‚Äî —ç—Ç–æ **—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** –≤ Pod-–µ. –û–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ containers.

---

**üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

‚Ä¢ –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**, –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
‚Ä¢ –ö–∞–∂–¥—ã–π –¥–æ–ª–∂–µ–Ω **—É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è (exit 0)** ‚Äî –∏–Ω–∞—á–µ Pod –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Init.
‚Ä¢ –ò–º–µ—é—Ç **–æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–º–∞–Ω–¥—ã** –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
‚Ä¢ –ú–æ–≥—É—Ç **–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ –∂–µ —Ç–æ–º–∞**, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

**üß™ –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å initContainers?**

‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—Ç–∞, –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–ë–î, Redis).

‚Ä¢ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ volume –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–ª—é—á–µ–π, —Å–µ–∫—Ä–µ—Ç–æ–≤.

‚Ä¢ –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞ –∏–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π.

---

**üîß –ü—Ä–∏–º–µ—Ä: –û–∂–∏–¥–∞–Ω–∏–µ –ë–î –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

```
apiVersion: v1
kind: Pod
metadata:
  name: app-with-init
spec:
  initContainers:
  - name: wait-for-db
    image: busybox
    command: ['sh', '-c', 'until nc -z db 5432; do echo waiting for db; sleep 2; done']
  containers:
  - name: main-app
    image: myapp:latest
    ports:
    - containerPort: 80
```

> –≠—Ç–æ—Ç initContainer –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ—Ä—Ç—É 5432. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç.

---

**üìÅ –ü—Ä–∏–º–µ—Ä: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ —Ç–æ–º**

```
spec:
  volumes:
  - name: config-volume
    emptyDir: {}

  initContainers:
  - name: copy-config
    image: busybox
    command: ['sh', '-c', 'cp /etc/config/* /config/']
    volumeMounts:
    - name: config-volume
      mountPath: /config
    - name: config-source
      mountPath: /etc/config

  containers:
  - name: app
    image: myapp
    volumeMounts:
    - name: config-volume
      mountPath: /app/config
```

---

**üß† –°–æ–≤–µ—Ç—ã:**
‚Ä¢ –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å initContainers, —á–µ–º –≥–æ—Ä–æ–¥–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–∂–∏–¥–∞–Ω–∏—è –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
‚Ä¢ –û–Ω–∏ —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è —Å emptyDir –∏ –¥—Ä—É–≥–∏–º–∏ volume-—Ç–∏–ø–∞–º–∏.
‚Ä¢ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –æ–±—Ä–∞–∑—ã, –≤ —Ç.—á. alpine, busybox, curlimages/curl –¥–ª—è —É—Ç–∏–ª–∏—Ç.


### Service Mesh
 
–≠—Ç–æ **—Å–ª–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ç–µ–≤—ã–º–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è–º–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.

**–û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:**

‚Ä¢ üì¶ **Service-to-Service communication** (–æ–±–º–µ–Ω —Ç—Ä–∞—Ñ–∏–∫–æ–º)
‚Ä¢ üîí **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞** (MTLS)
‚Ä¢ üéØ **Routing & Canary** (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, A/B, Canary)
‚Ä¢ üìä **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** (–º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏, –ª–æ–≥–∏)
‚Ä¢ üîÅ **Retry, timeout, circuit breaker** (–º–µ—Ö–∞–Ω–∏–∫–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏)
‚Ä¢ üö¶ **Policy control** (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, ACL)

---

#### üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è ‚Äî **Sidecar Proxy**.

–ö–∞–∂–¥–æ–º—É Pod-—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è **–ø—Ä–æ–∫—Å–∏-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (–æ–±—ã—á–Ω–æ Envoy), —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π **–≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏** –∏–¥—ë—Ç:

```
[service A] <=> [Envoy A] <===> [Envoy B] <=> [service B]
```

> –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ control-plane (–Ω–∞–ø—Ä–∏–º–µ—Ä, Istiod –≤ Istio).

---

**üéØ –ó–∞—á–µ–º –Ω—É–∂–µ–Ω?**

|**–ë–µ–∑ Service Mesh**|**–° Service Mesh**|
|---|---|
|–°–∞–º –ø–∏—à–µ—à—å retry, timeout|–ó–∞–¥–∞—ë—à—å –≤ YAML, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏|
|TLS –Ω–∞–¥–æ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤ –∫–æ–¥|MTLS –∞–≤—Ç–æ–º–∞—Ç–æ–º –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏|
|–õ–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ|Traffic shifting —á–µ—Ä–µ–∑ CRD|
|–ú–µ—Ç—Ä–∏–∫–∏ –≤ app|–ê–≤—Ç–æ-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus/Grafana/Jaeger|
|Manual discovery|–í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Å–µ—Ä–≤–∏—Å-–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ|

---

#### üõ† –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö Service Mesh

##### Istio (–¥–µ-—Ñ–∞–∫—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –º–æ—â–Ω—ã–π, –Ω–æ —Ç—è–∂–µ–ª–æ–≤–∞—Ç)

‚Ä¢ Control-plane: istiod

‚Ä¢ Data-plane: Envoy

‚Ä¢ CRD‚Äô—ã: VirtualService, DestinationRule, Gateway, AuthorizationPolicy, –∏ –¥—Ä.

‚Ä¢ –°–∏–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ MTLS, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏, observability.

---

**üß™ –ü—Ä–∏–º–µ—Ä: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–º –≤ Istio**

```
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:
    - reviews
  http:
    - route:
        - destination:
            host: reviews
            subset: v1
          weight: 90
        - destination:
            host: reviews
            subset: v2
          weight: 10
```

> 90% —Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ–π–¥—ë—Ç –≤ v1, 10% ‚Äî –≤ v2. –≠—Ç–æ –ø—Ä–∏–º–µ—Ä **canary deployment** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

---

#### üîê MTLS ‚Äî –≤—Å—ë —à–∏—Ñ—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–¢—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É Pod-–∞–º–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω**, –∏ –º–æ–∂–Ω–æ **–≤–∫–ª—é—á–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É Zero Trust** ‚Äî —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è.

```
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
spec:
  mtls:
    mode: STRICT
```

---
#### üìä Observability –∏–∑ –∫–æ—Ä–æ–±–∫–∏

–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫, –ª–æ–≥–æ–≤, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫:

‚Ä¢ üìà Prometheus / Grafana

‚Ä¢ üîé Kiali (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è mesh-–∞)

‚Ä¢ üßµ Jaeger / Zipkin (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏)


### üîß Service

| **–¢–∏–ø**          | **–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø** | **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**           | **–ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**                          |
| ---------------- | ------------------ | ------------------------------ | ----------------------------------------------- |
| **ClusterIP**    | ‚ùå –ù–µ—Ç              | –í–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞                | curl my-svc.default.svc.cluster.local           |
| **NodePort**     | ‚úÖ –î–∞               | Bare-metal, Minikube           | curl http://<\NodeIP>:30080                     |
| **LoadBalancer** | ‚úÖ –î–∞ (–æ–±–ª–∞–∫–æ)      | GKE, EKS, AKS, MetalLB         | curl http://\<\EXTERNAL-IP>                     |
| **ExternalName** | ‚ö†Ô∏è –ß–µ—Ä–µ–∑ DNS       | –î–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º      | curl http://external-service.local (CNAME)      |
| **Headless**     | ‚ùå –ù–µ—Ç (IP –Ω–µ—Ç)     | StatefulSet, Service Discovery | dig my-svc.default.svc.cluster.local ‚Üí IP –ø–æ–¥–æ–≤ |

–≠—Ç–æ **–±–∞–∑–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å Kubernetes**, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚Ä¢ —Å–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏ –ø–æ –∏–º–µ–Ω–∏ (DNS),
‚Ä¢ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π IP,
‚Ä¢ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ Pod-—ã –ø–æ label‚Äô–∞–º.

```
apiVersion: v1
kind: Service
metadata:
  name: reviews
spec:
  selector:
    app: reviews
  ports:
    - port: 80
      targetPort: 8080
```

> –í—Å–µ Pod-—ã —Å app=reviews –ø–æ–ª—É—á–∞—Ç —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç Service.

---

#### üß± ClusterIP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```
apiVersion: v1
kind: Service
metadata:
  name: my-svc
spec:
  selector:
    app: my-app
  ports:
    - port: 80        # –í–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
      targetPort: 8080
```

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞.
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –î–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
- **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ–±—Ä–∞—â–∞–µ—Ç—Å—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥.

```
spec:
¬† type: ClusterIP
```

#### üåê NodePort

```
apiVersion: v1
kind: Service
metadata:
  name: my-nodeport-svc
spec:
  type: NodePort
  selector:
    app: my-app
  ports:
    - port: 80
      targetPort: 8080
      nodePort: 30080
```

> –î–æ—Å—Ç—É–ø: http://<NodeIP\>:30080

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞.
- **–î–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ**: –î–∞, –ø–æ IP-–∞–¥—Ä–µ—Å—É –Ω–æ–¥—ã –∏ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø–æ—Ä—Ç—É.
- **–î–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤**: 30000‚Äì32767 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ä—É–∂—É –±–µ–∑ Ingress.

#### üåé LoadBalancer

```
apiVersion: v1
kind: Service
metadata:
  name: my-lb-svc
spec:
  type: LoadBalancer
  selector:
    app: my-app
  ports:
    - port: 80
      targetPort: 8080
```

> –í –æ–±–ª–∞–∫–∞—Ö ‚Äî –≤—ã–¥–∞—Å—Ç EXTERNAL-IP —á–µ—Ä–µ–∑ kubectl get svc

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ (–æ–±—ã—á–Ω–æ –≤ –æ–±–ª–∞–∫–µ).
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, production-ready –ø–æ–¥—Ö–æ–¥.
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ–±–ª–∞—á–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º (GKE, EKS, AKS –∏ –¥—Ä).


#### üîó¬†ExternalName

```
spec:
  type: ExternalName
  externalName: my.external.service.com
```

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–µ–º—É DNS-–∏–º–µ–Ω–∏.
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ DNS, –∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ –æ–±—ã—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ù–µ —Å–æ–∑–¥–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π IP, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ CNAME.

#### üß™ Headless Service

```
spec:
¬† clusterIP: None
```

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–µ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç IP-–∞–¥—Ä–µ—Å; –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ IP –ø–æ–¥–æ–≤.
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ –≤–∞–∂–µ–Ω –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ–¥–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, StatefulSet, —Å–µ—Ä–≤–∏—Å discovery.
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –í–º–µ—Å—Ç–æ –±–∞–ª–∞–Ω—Å–∞ ‚Äî –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã.

#### üîß **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**

–ù–µ —è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏, –Ω–æ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

- **Ingress** ‚Äî _–Ω–µ —Å–µ—Ä–≤–∏—Å, –∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏_. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è HTTP/HTTPS –≤—Ö–æ–¥–∞ –∏ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞.
- **Service Mesh (–Ω–∞–ø—Ä–∏–º–µ—Ä, Istio, Linkerd)** ‚Äî –¥–æ–±–∞–≤–ª—è—é—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –Ω–∞–¥ —Å–µ—Ä–≤–∏—Å–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ L7.
- **MetalLB / Kube-vip** ‚Äî —Ä–∞—Å—à–∏—Ä—è—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ LoadBalancer –≤ on-premise –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö, –≥–¥–µ –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –æ–±–ª–∞—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞.

### üïπ Istio VirtualService

–≠—Ç–æ **—Ä–µ—Å—É—Ä—Å —É—Ä–æ–≤–Ω—è Istio**, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:

‚Ä¢ **–ö–∞–∫ –∏–º–µ–Ω–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫** –≤–Ω—É—Ç—Ä–∏ Service
‚Ä¢ –î–µ–ª–∞—Ç—å canary, A/B, header-based routing –∏ —Ç.–¥.
‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å retry, timeout, fault injection –∏ —Ç.–ø.

```
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-routing
spec:
  hosts:
    - reviews
  http:
    - match:
        - headers:
            end-user:
              exact: test-user
      route:
        - destination:
            host: reviews
            subset: v2
    - route:
        - destination:
            host: reviews
            subset: v1
```

> –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ: –µ—Å–ª–∏ —é–∑–µ—Ä ‚Äî test-user, –æ—Ç–¥–∞—Ç—å reviews:v2, –∏–Ω–∞—á–µ ‚Äî v1.

---

**üîÑ –ö–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ**

‚Ä¢ Service ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **‚Äú–∫—É–¥–∞‚Äù**: –Ω–∞–±–æ—Ä Pod-–æ–≤ (endpoints)

‚Ä¢ VirtualService ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **‚Äú–∫–∞–∫‚Äù**: –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –≤–µ—Ä—Å–∏–∏, —É—Å–ª–æ–≤–∏—è

**–¢—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç —Ç–∞–∫:**

```
Client ‚Üí Kubernetes Service ‚Üí Istio Proxy (Envoy) ‚Üí VirtualService ‚Üí Target Pod
```

---

**üì¶ –ê —á—Ç–æ —Ç–∞–∫–æ–µ subset?**

–ß—Ç–æ–±—ã VirtualService –º–æ–≥ –≤—ã–±—Ä–∞—Ç—å v1, v2, —Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å DestinationRule:

```
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews-dest
spec:
  host: reviews
  subsets:
    - name: v1
      labels:
        version: v1
    - name: v2
      labels:
        version: v2
```

> –¢–µ–ø–µ—Ä—å Istio —Å–º–æ–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ Pod-—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö version: v1 –∏–ª–∏ v2.

---

### Ingress

Kubernetes —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø—Ä–∞–≤–∏–ª–∞ –≤—Ö–æ–¥–∞ HTTP/HTTPS-—Ç—Ä–∞—Ñ–∏–∫–∞** –≤ –∫–ª–∞—Å—Ç–µ—Ä –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∫ —Å–µ—Ä–≤–∏—Å–∞–º.

**–ü—Ä–∏–º–µ—Ä:**

```
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
    - host: mysite.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: my-service
                port:
                  number: 80
```

üìå –ù–æ —Å–∞–º Ingress –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞!

#### üéÆ Ingress Controller ‚Äî —á—Ç–æ —ç—Ç–æ?

> **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ–¥/–¥–µ–ø–ª–æ–π–º–µ–Ω—Ç)**, –∫–æ—Ç–æ—Ä–æ–µ **—á–∏—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã Ingress** –∏ **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä** (–Ω–∞–ø—Ä–∏–º–µ—Ä, NGINX) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã:**

‚Ä¢ nginx-ingress ‚úÖ (–¥–µ-—Ñ–∞–∫—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç)

‚Ä¢ traefik

‚Ä¢ HAProxy

‚Ä¢ Istio Gateway (–≤ —Ä–∞–º–∫–∞—Ö Istio)

‚Ä¢ AWS ALB Controller (–≤ AWS)

---
**üîÅ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
[–ë—Ä–∞—É–∑–µ—Ä] 
  ‚Üì HTTP/HTTPS
[Ingress Controller Pod (–Ω–∞–ø—Ä–∏–º–µ—Ä, NGINX)]
  ‚Üì
[Ingress rules ‚Üí Service ‚Üí Pod]
```

---

#### üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Ingress:

‚Ä¢ –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (host + path)

‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS (—á–µ—Ä–µ–∑ TLS-—Å–µ–∫—Ä–µ—Ç—ã)

‚Ä¢ –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (timeouts, redirects –∏ —Ç.–¥.)

#### üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Ingress Controller:

‚Ä¢ –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç (80/443)

‚Ä¢ –°—á–∏—Ç—ã–≤–∞–µ—Ç Ingress-–æ–±—ä–µ–∫—Ç—ã

‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–∫—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, nginx.conf)

‚Ä¢ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---
#### üß† –ö—Ä–∞—Ç–∫–æ:

| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**      | **–†–æ–ª—å**                              |
| ------------------ | ------------------------------------- |
| Ingress            | –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏                 |
| Ingress Controller | –ü—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç |

### ReplicaSet (–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π)

> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Pod-–æ–≤**. –°–∞–º –ø–æ —Å–µ–±–µ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

```
apiVersion: apps/v1
kind: ReplicaSet
spec:
  replicas: 3
```

‚Ä¢ –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç: _N —Ä–µ–ø–ª–∏–∫_
‚Ä¢ –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, rollback
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ Deployment**

üìå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–∞–ø—Ä—è–º—É—é ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Deployment.

---
### Deployment (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è stateless –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)

> –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**, **–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**, **–æ—Ç–∫–∞—Ç**.

```
apiVersion: apps/v1
kind: Deployment
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
```

‚Ä¢ –ü–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±–Ω–æ–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞**

‚Ä¢ –ï—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (RollingUpdate, Recreate)

‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç rollback, pause, resume

  

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, API, —Å–µ—Ä–≤–∏—Å–æ–≤.

---

### DaemonSet

> –ó–∞–ø—É—Å–∫–∞–µ—Ç **–ø–æ –æ–¥–Ω–æ–º—É Pod-—É –Ω–∞ –∫–∞–∂–¥–æ–π Node**.

```
apiVersion: apps/v1
kind: DaemonSet
```

‚Ä¢ –ü–æ–ª–µ–∑–µ–Ω –¥–ª—è: –ª–æ–≥–≥–µ—Ä–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∞–≥–µ–Ω—Ç–∞ (Prometheus, Fluentd)

‚Ä¢ –ù–æ–≤—ã–µ –Ω–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç Pod

‚Ä¢ –ë–µ–∑ replicas ‚Äî –æ–Ω —Å–∞–º –∑–Ω–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –Ω–æ–¥

  

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

---

### StatefulSet

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **stateful-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** (–ë–î, –∫—ç—à, –æ—á–µ—Ä–µ–¥–∏), –≥–¥–µ **–≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –∏ –∏–º–µ–Ω–∞ Pod-–æ–≤**.

```
apiVersion: apps/v1
kind: StatefulSet
spec:
  serviceName: my-headless
```

‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ Pod-–æ–≤: mongo-0, mongo-1

‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **PersistentVolumeClaim templates**

‚Ä¢ –ó–∞–ø—É—Å–∫–∞–µ—Ç/—É–¥–∞–ª—è–µ—Ç Pod‚Äô—ã –ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ

  

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: PostgreSQL, Cassandra, Kafka, Redis Cluster

---
### Job

> –í—ã–ø–æ–ª–Ω—è–µ—Ç **–æ–¥–∏–Ω–æ—á–Ω—É—é –∑–∞–¥–∞—á—É**, –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

```
apiVersion: batch/v1
kind: Job
spec:
  completions: 1
```

‚Ä¢ –°–æ–∑–¥–∞—ë—Ç Pod –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏

‚Ä¢ –ü–æ–≤—Ç–æ—Ä—è–µ—Ç, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ—É—Å–ø–µ—à–Ω–∞

‚Ä¢ –°–∞–º —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (–∏–ª–∏ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏)

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: –º–∏–≥—Ä–∞—Ü–∏–π, –∏–º–ø–æ—Ä—Ç–æ–≤, –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

---
### CronJob

> –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Job –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ)

```
apiVersion: batch/v1
kind: CronJob
spec:
  schedule: "*/5 * * * *"
```

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: –±—ç–∫–∞–ø–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤

---

### Pod controllers comparation

| **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** | **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | **–•—Ä–∞–Ω–∏—Ç —Å—Ç–µ–π—Ç** | **–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å** | **–û–¥–Ω–∞ –∑–∞–¥–∞—á–∞** | **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**  |
| -------------- | -------------------- | ---------------- | ----------------- | --------------- | ------------------------- |
| Deployment     | ‚úÖ –î–∞                 | ‚ùå –ù–µ—Ç            | ‚ùå –ù–µ—Ç             | ‚ùå –ù–µ—Ç           | web-app, API, worker      |
| ReplicaSet     | ‚úÖ –î–∞                 | ‚ùå –ù–µ—Ç            | ‚ùå –ù–µ—Ç             | ‚ùå –ù–µ—Ç           | (–≤–Ω—É—Ç—Ä–∏ Deployment)       |
| DaemonSet      | ‚ùå 1 –Ω–∞ Node          | ‚ùå –ù–µ—Ç            | ‚ùå –ù–µ—Ç             | ‚ùå –ù–µ—Ç           | node exporter, log-–∞–≥–µ–Ω—Ç—ã |
| StatefulSet    | ‚úÖ –î–∞                 | ‚úÖ –î–∞             | ‚ùå –ù–µ—Ç             | ‚ùå –ù–µ—Ç           | PostgreSQL, Redis cluster |
| Job            | ‚ùå (–æ–¥–∏–Ω –∑–∞–ø—É—Å–∫)      | ‚ùå –ù–µ—Ç            | ‚ùå –ù–µ—Ç             | ‚úÖ –î–∞            | –º–∏–≥—Ä–∞—Ü–∏—è, ETL, init-task  |
| CronJob        | ‚ùå                    | ‚ùå –ù–µ—Ç            | ‚úÖ –î–∞              | ‚úÖ –î–∞            | –±—ç–∫–∞–ø –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç      |

### PVC

**PVC (PersistentVolumeClaim)** ‚Äî —ç—Ç–æ **–∑–∞—è–≤–∫–∞ –æ—Ç Pod-–∞ –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**. –≠—Ç–æ –∫–∞–∫ ‚Äú–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞‚Äù: —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å, –∫–∞–∫–æ–π –æ–±—ä—ë–º –∏ –¥–æ—Å—Ç—É–ø —Ç–µ–±–µ –Ω—É–∂–µ–Ω ‚Äî –∞ Kubernetes —Å–∞–º –≤—ã–¥–µ–ª—è–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (PersistentVolume) –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ (–≤ —Å–ª—É—á–∞–µ dynamic provisioning).

---

**üß± –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Kubernetes**

1. **PersistentVolume (PV)** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∏–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ (–¥–æ–ª–≥–æ–≤–µ—á–Ω—ã–π —Ç–æ–º).
2. **PersistentVolumeClaim (PVC)** ‚Äî –∑–∞–ø—Ä–æ—Å –æ—Ç Pod-–∞: ‚Äú–¥–∞–π –º–Ω–µ –¥–∏—Å–∫ –Ω–∞ 1Gi, —Å RW –¥–æ—Å—Ç—É–ø–æ–º‚Äù.
3. **StorageClass** ‚Äî —à–∞–±–ª–æ–Ω, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π, **–∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å PV** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∏–ø –¥–∏—Å–∫–∞ –≤ –æ–±–ª–∞–∫–µ: SSD, HDD, reclaim policy –∏ —Ç.–ø.).

---

**üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª: –∫–∞–∫ –≤—Å—ë —Å–≤—è–∑–∞–Ω–æ**

```
Pod ‚Üí PersistentVolumeClaim (PVC) ‚Üí PersistentVolume (PV) ‚Üí Physical disk (GCE, EBS, NFS, Ceph, etc)
```
---

**üîß –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π PVC + Pod**  

**üìÑ PVC:**

```
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
```

**üìÑ –ü–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —ç—Ç–æ—Ç PVC:**

```
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: app
      image: nginx
      volumeMounts:
        - name: my-storage
          mountPath: /usr/share/nginx/html
  volumes:
    - name: my-storage
      persistentVolumeClaim:
        claimName: my-pvc
```

> üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç **–ø—É—Ç—å /usr/share/nginx/html**, –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ PVC.

---

**üìö –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PVC**

|**–ü–∞—Ä–∞–º–µ—Ç—Ä**|**–ó–Ω–∞—á–µ–Ω–∏–µ**|
|---|---|
|storage|–°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1Gi)|
|accessModes|ReadWriteOnce, ReadOnlyMany, ReadWriteMany|
|volumeMode|Filesystem (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ Block|
|storageClassName|–ö–∞–∫–æ–π StorageClass –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å|

---

**üîÅ Static vs Dynamic provisioning**

|**–¢–∏–ø**|**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**|
|---|---|
|**Static**|–ê–¥–º–∏–Ω –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞—ë—Ç PV, —Ç—ã –¥–µ–ª–∞–µ—à—å PVC –∏ –∂–¥—ë—à—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º|
|**Dynamic** ‚úÖ|PVC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç StorageClass, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç PV –Ω–∞ –ª–µ—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, EBS –≤ AWS, Persistent Disk –≤ GCP)|

---

**üìÑ –ü—Ä–∏–º–µ—Ä: PVC —Å StorageClass**

```
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: fast-storage
spec:
  storageClassName: "fast-ssd"
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
```

---

**üß† –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:**

```
kubectl get pvc
kubectl describe pvc my-pvc
kubectl get pv
```

> –°—Ç–∞—Ç—É—Å PVC –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Bound, –µ—Å–ª–∏ –≤—Å—ë –æ–∫.

---

**üóë Reclaim Policy (—á—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è PVC)**

‚Ä¢ Delete ‚Äî PV –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –≤–º–µ—Å—Ç–µ —Å PVC (—á–∞—Å—Ç–æ –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏)

‚Ä¢ Retain ‚Äî –¥–∏—Å–∫ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –≤—Ä—É—á–Ω—É—é

‚Ä¢ Recycle (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π)

---

**üì¶ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è PVC?**

‚Ä¢ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL, MongoDB)

‚Ä¢ CMS (WordPress)

‚Ä¢ –ö—ç—à (Redis —Å persistence)

‚Ä¢ –•–æ—Å—Ç–∏–Ω–≥ —Å—Ç–∞—Ç–∏–∫–∏ –≤ Nginx

‚Ä¢ Kafka, MinIO, Ceph, –∏ —Ç.–¥.

---


### GitOps vs Helm

**üéØ –°—É—Ç—å –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:**

| **–ü–æ–¥—Ö–æ–¥**   | **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**                                                                   |
| ------------ | -------------------------------------------------------------------------------- |
| **Helm CLI** | –¢—ã **–≤—Ä—É—á–Ω—É—é –ø—Ä–∏–º–µ–Ω—è–µ—à—å Helm —á–∞—Ä—Ç—ã** —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏–ª–∏ CI/CD                |
| **GitOps**   | –¢—ã **—Ö—Ä–∞–Ω–∏—à—å –≤—Å—ë –≤ Git**, –∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ **—Å–∞–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ** |

---

**‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–π –ø–æ–¥—Ö–æ–¥**


**üì¶ 1. Helm deployment (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)**

‚Ä¢ –¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –∫–æ–º–∞–Ω–¥—É:

```
helm upgrade --install my-app ./chart --values values.yaml
```

‚Ä¢ –ò–ª–∏ —á–µ—Ä–µ–∑ CI (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitLab CI).

‚Ä¢ Helm —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å—ë –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–ª–∞—Å—Ç–µ—Ä.

‚Ä¢ **–°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –≤ Helm –∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ**, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ Git.

üîª –ü—Ä–æ–±–ª–µ–º—ã:

‚Ä¢ –ù–µ—Ç 100% –≥–∞—Ä–∞–Ω—Ç–∏–π, —á—Ç–æ Git = –∫–ª–∞—Å—Ç–µ—Ä.

‚Ä¢ –ù—É–∂–Ω–æ —Å–∞–º–æ–º—É —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ø–æ—Ä—è–¥–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

‚Ä¢ –ú–æ–∂–Ω–æ ‚Äú–≤–º–µ—à–∞—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é‚Äù –∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ Git.

---

**üîÅ 2. GitOps (ArgoCD, FluxCD)**

‚Ä¢ –¢—ã **–∫–ª–∞–¥—ë—à—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∏–ª–∏ Helm values –≤ Git**.

‚Ä¢ Git = –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã.

‚Ä¢ –í –∫–ª–∞—Å—Ç–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç **–æ–ø–µ—Ä–∞—Ç–æ—Ä (ArgoCD/Flux)**, –∫–æ—Ç–æ—Ä—ã–π:

‚Ä¢ –°–º–æ—Ç—Ä–∏—Ç –≤ Git

‚Ä¢ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã/Helm —á–∞—Ä—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä

‚Ä¢ –°–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –∫–ª–∞—Å—Ç–µ—Ä –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª Git

> Git ‚Üí –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Üí –∫–ª–∞—Å—Ç–µ—Ä

---

**üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º –∞—Å–ø–µ–∫—Ç–∞–º:**

| **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**           | **GitOps**                                     | **Helm (—Ä—É—á–Ω–æ–π)**                     |
| ----------------------- | ---------------------------------------------- | ------------------------------------- |
| üß† –ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã      | Git                                            | Helm state / CI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è / –ø–∞–º—è—Ç—å |
| üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å       | –î–∞ (pull model)                                | –ù–µ—Ç (push model)                      |
| üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ | –ù–µ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–ª–∞—Å—Ç–µ—Ä—É ‚Äî —Ç–æ–ª—å–∫–æ Git        | –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∫–ª–∞—Å—Ç–µ—Ä—É           |
| üõ† –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π      | Git revert ‚Üí –∞–≤—Ç–æ–æ—Ç–∫–∞—Ç                         | –ù–∞–¥–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å helm rollback  |
| üëÄ Observability        | UI (ArgoCD/Flux) —Å –¥–∏—Ñ–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏          | helm status, logs                     |
| ‚úçÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ Git    | **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ Git-—Å–æ—Å—Ç–æ—è–Ω–∏—é** | –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (drift!)                  |
| üîÅ –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π   | –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è                       | –¢–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∫–æ–º–∞–Ω–¥—ã             |

---

**ü§ñ ArgoCD + Helm = ‚ù§Ô∏è**

–¢—ã –º–æ–∂–µ—à—å **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Helm –≤–Ω—É—Ç—Ä–∏ GitOps**, –ø—Ä–æ—Å—Ç–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤ —á–∞—Ä—Ç—ã –∏ values –≤ Git:

```
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: my-app
spec:
  source:
    repoURL: https://github.com/my-org/my-repo
    targetRevision: main
    path: charts/my-app
    helm:
      valueFiles:
        - values-prod.yaml
```

> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç—ã **–Ω–µ —Ç–µ—Ä—è–µ—à—å –≥–∏–±–∫–æ—Å—Ç—å Helm**, –Ω–æ –ø–æ–ª—É—á–∞–µ—à—å **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é GitOps**.

---

**üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?**

| **–°—Ü–µ–Ω–∞—Ä–∏–π**                              | **–ü–æ–¥—Ö–æ–¥** |
| ----------------------------------------- | ---------- |
| –ú–∞–ª–µ–Ω—å–∫–∏–π pet-–ø—Ä–æ–µ–∫—Ç                      | Helm CLI   |
| –ö–æ–º–∞–Ω–¥–∞/–ø—Ä–æ–¥/–º–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏–π              | GitOps     |
| –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É–¥–∏—Ç, –æ—Ç–∫–∞—Ç, –≤–∏–¥–∏–º–æ—Å—Ç—å         | GitOps     |
| –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–∑ CI (—Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å)     | Helm CLI   |
| –ú–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥ | GitOps     |

### RBAC

**RBAC (Role-Based Access Control)** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ Kubernetes, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ä–æ–ª—è—Ö. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Ä–∞–∑–≥—Ä–∞–Ω–∏—á–∏—Ç—å, –∫—Ç–æ —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ**.

RBAC —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **—á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞**:

‚Ä¢ Role
‚Ä¢ ClusterRole
‚Ä¢ RoleBinding
‚Ä¢ ClusterRoleBinding

!!!
rolebinding –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ clusterrole binding –∏ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —é–∑–µ—Ä—É –≤ —Ä–∞–º–∫–∞—Ö –Ω–µ–π–º—Å–ø–µ–π—Å–∞
!!!

#### üß± –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

|**–û–±—ä–µ–∫—Ç**|**–ì–¥–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç**|**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**|
|---|---|---|
|Role|–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö **namespace**|–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è|
|ClusterRole|–¥–µ–π—Å—Ç–≤—É–µ—Ç **–∫–ª–∞—Å—Ç–µ—Ä–Ω–æ**|–ú–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ –∏–ª–∏ –∫ namespace|
|RoleBinding|**–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö namespace**|–ù–∞–∑–Ω–∞—á–∞–µ—Ç Role –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–≥—Ä—É–ø–ø–µ|
|ClusterRoleBinding|**–≥–ª–æ–±–∞–ª—å–Ω–æ**|–ù–∞–∑–Ω–∞—á–∞–µ—Ç ClusterRole –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–≥—Ä—É–ø–ø–µ –Ω–∞ –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ NS|

---

##### üìå –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π Role –∏ RoleBinding

```
# role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]
```

```
# rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: dev
subjects:
- kind: User
  name: alice
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```

üìå –≠—Ç–æ –¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é alice –¥–æ—Å—Ç—É–ø –Ω–∞ **—á—Ç–µ–Ω–∏–µ –ø–æ–¥–æ–≤ –≤ namespace dev**.

---

##### üìå –ü—Ä–∏–º–µ—Ä 2: ClusterRole + ClusterRoleBinding

```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: node-reader
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "watch", "list"]
```

```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: read-nodes
subjects:
- kind: User
  name: bob
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: node-reader
  apiGroup: rbac.authorization.k8s.io
```

üìå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å bob –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ –Ω–æ–¥ **–≤–æ –≤—Å—ë–º –∫–ª–∞—Å—Ç–µ—Ä–µ**.

---

##### üß† –ß—Ç–æ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ rules?

```
rules:
- apiGroups: ["", "apps", "batch"]
  resources: ["pods", "deployments", "jobs"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

‚Ä¢ apiGroups: –Ω–∞–ø—Ä–∏–º–µ—Ä, "" ‚Äî core, "apps" ‚Äî –¥–ª—è deployments –∏ —Ç.–¥.

‚Ä¢ resources: "pods", "services", "configmaps" –∏ —Ç.–¥.

‚Ä¢ verbs: "get", "list", "create", "delete", "update", "patch"‚Ä¶

---

**üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞**

–•–æ—á–µ—à—å –ø–æ–Ω—è—Ç—å, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/—Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç –¥–æ—Å—Ç—É–ø?

```
kubectl auth can-i get pods --as alice --namespace=dev
```

–∏–ª–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç–∞:

```
kubectl auth can-i create deployments --as=system:serviceaccount:dev:sa-name
```

---

##### ‚ö†Ô∏è RBAC –∏ —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç—ã

–î–ª—è pod‚Äô–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å Kubernetes API, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç (SA).

üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ClusterRole –Ω–∞ SA:

```
subjects:
- kind: ServiceAccount
  name: my-sa
  namespace: dev
```

üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Prometheus, ArgoCD, Jenkins, etc.

---

#### **üéØ –ß–∞—Å—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**

‚Ä¢ view, edit, admin ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ ClusterRole
‚Ä¢ Least Privilege ‚Äî –¥–∞—ë–º **—Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ**
‚Ä¢ aggregated ClusterRole ‚Äî —Å–±–æ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∞–≤ –≤ –æ–¥–Ω—É —Ä–æ–ª—å
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π **kubectl auth reconcile** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è RBAC


##### üîê 1. –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏: view, edit, admin

Kubernetes –∏–∑ –∫–æ—Ä–æ–±–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö ClusterRole**, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–æ–∂–µ—à—å —Å—Ä–∞–∑—É –ø—Ä–∏–≤—è–∑–∞—Ç—å:

|**–†–æ–ª—å**|**–ß—Ç–æ —É–º–µ–µ—Ç?**|
|---|---|
|view|–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ (get, list, watch)|
|edit|–ß—Ç–µ–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–∫—Ä–æ–º–µ RBAC, NS, finalizers)|
|admin|–í—Å—ë –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö namespace, –≤–∫–ª—é—á–∞—è RBAC (–Ω–æ **–Ω–µ ClusterRole**)|

**–ü—Ä–∏–º–µ—Ä:**

```
kind: RoleBinding
metadata:
  name: give-access
  namespace: dev
subjects:
- kind: User
  name: alice
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: view
  apiGroup: rbac.authorization.k8s.io
```

üìå –û—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–∞–≤–∞—Ç—å –ª—é–¥—è–º –∏–ª–∏ –±—ç–∫—É –¥–æ—Å—Ç—É–ø ‚Äú–Ω–∞ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å‚Äù.

---
##### üßÉ 2. Least Privilege (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞)

‚ö†Ô∏è **–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –¥–∞–≤–∞–π –º–∏–Ω–∏–º—É–º, —á—Ç–æ –Ω—É–∂–Ω–æ.

–ù–∏–∫–∞–∫–∏—Ö * –≤ verbs, resources, apiGroups –±–µ–∑ –æ—Å—Ç—Ä–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏!

**–ü–ª–æ—Ö–æ–π –ø—Ä–∏–º–µ—Ä:**

```
verbs: ["*"]
resources: ["*"]
apiGroups: ["*"]
```

**–•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä:**

```
verbs: ["get", "list"]
resources: ["pods"]
apiGroups: [""]
```

üìå –ü—Ä–∏–Ω—Ü–∏–ø ‚Äú—á–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º –ª—É—á—à–µ‚Äù –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –¥–ª—è —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç–æ–≤ CI/CD, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

---

##### üß¨ 3. ServiceAccount + RoleBinding: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ Pod‚Äô–∞–º

–ß–∞—Å—Ç–æ —Å–µ—Ä–≤–∏—Å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Prometheus, Argo, Karpenter) –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥–æ—Å—Ç—É–ø–µ –∫ API. –í–º–µ—Å—Ç–æ –ø—Ä–∏–≤—è–∑–∫–∏ –ø—Ä–∞–≤ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî —Å–æ–∑–¥–∞—ë–º **ServiceAccount + RoleBinding**.

```
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-agent
  namespace: monitoring
```

```
kind: RoleBinding
metadata:
  name: my-agent-binding
  namespace: monitoring
subjects:
- kind: ServiceAccount
  name: my-agent
  namespace: monitoring
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```

üìå –ó–∞—Ç–µ–º —É pod‚Äô–∞ –≤ spec.serviceAccountName: my-agent.

---
##### üß© 4. Aggregated ClusterRoles ‚Äî –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö

–ú–æ–∂–Ω–æ **–æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ ClusterRole —á–µ—Ä–µ–∑ –º–µ—Ç–∫–∏**, –∞ –Ω–µ –ø–∏—Å–∞—Ç—å –æ–¥–Ω—É –±–æ–ª—å—à—É—é.

```
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-viewer
  labels:
    rbac.authorization.k8s.io/aggregate-to-view: "true"
rules:
- apiGroups: ["batch"]
  resources: ["jobs"]
  verbs: ["get", "list", "watch"]
```

–ï—Å–ª–∏ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ —É–∂–µ –µ—Å—Ç—å ClusterRole —Å –º–µ—Ç–∫–æ–π aggregate-to-view=true, —Ç–æ —Ç–≤–æ—è —Ä–æ–ª—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è**.

  

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö admin / edit / view.

---

##### üß™ 5. Dynamic access (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ GitOps)

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å ArgoCD, Flux –∏–ª–∏ Helm ‚Äî –º–æ–∂–Ω–æ **–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å RBAC —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω—ã** –∏–ª–∏ Git-–ø–∞–ø–∫–∏:

‚Ä¢ –°–µ—Ä–≤–∏—Å argo-server –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SA —Å ClusterRole admin

‚Ä¢ Helm chart —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ Role/RoleBinding —á–µ—Ä–µ–∑ values.yaml

---

##### üìÅ 6. –ú—É–ª—å—Ç–∏-Namespace RBAC

Role —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ NS. –ß—Ç–æ–±—ã –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ NS ‚Äî **–∏—Å–ø–æ–ª—å–∑—É–π ClusterRole + –Ω–µ—Å–∫–æ–ª—å–∫–æ RoleBinding**:

```
# reusable ClusterRole
kind: ClusterRole
metadata:
  name: read-pods
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]

# –≤ dev
kind: RoleBinding
metadata:
  name: bind-in-dev
  namespace: dev
subjects:
- kind: User
  name: alice
roleRef:
  kind: ClusterRole
  name: read-pods

# –≤ staging
kind: RoleBinding
metadata:
  name: bind-in-staging
  namespace: staging
subjects:
- kind: User
  name: alice
roleRef:
  kind: ClusterRole
  name: read-pods
```


---

##### üß† –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:

‚Ä¢ kubectl auth can-i ‚Äî —Ç–≤–æ–π –¥—Ä—É–≥.

‚Ä¢ –°–º–æ—Ç—Ä–∏ kubectl describe rolebinding –∏ clusterrolebinding ‚Äî –≤–∏–¥–Ω–æ, –∫—Ç–æ –∫ —á–µ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω.

‚Ä¢ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ dry-run –∏–ª–∏ –≤ dev-NS.

‚Ä¢ GitOps-friendly –ø–æ–¥—Ö–æ–¥: –≤—Å–µ —Ä–æ–ª–∏ –∏ –±–∏–Ω–¥–∏–Ω–≥–∏ ‚Äî –≤ yaml –∏ –ø–æ–¥ –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.

---

## Terraform

### –û—Ç–ª–∏—á–∏–µ ansible –∏ terraform


**Terraform**¬†- –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–∫ –∫–æ–¥ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –µ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

**Ansible**¬†- –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

–¢–æ –µ—Å—Ç—å Terraform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ –±—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã, —Å–µ—Ç–∏, –¥–∏—Å–∫–∏, –∏ —Ç–ø.). Ansible –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–ø—Ä–æ–≥—Ä–∞–º–º—ã, –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã) –Ω–∞ —ç—Ç–∏—Ö –≤–∏—Ä—Ç—É–∞–ª–∫–∞—Ö.

–ù—é–∞–Ω—Å—ã: Terraform –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–µ–ª–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π. Ansible –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –∏ –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π.

–ù—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –ò –≤ —Ä—è–¥–µ —Å–ª—É—á–∞–µ–≤ —Å –ø–æ–º–æ—â—å—é Ansible —Ä–∞–≤–∑–≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å—ë —Ç–∞–∫–∏ –º–æ–∂–Ω–æ. –ö–∞–∫ –∏ –¥–ª—è —Ç–µ—Ä—Ä–∞—Ñ–æ—Ä–º–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–≤–æ–µ. –í–æ–ø—Ä–æ—Å –ª–∏—à—å –≤ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Terraform state?

‚Ä¢ State-—Ñ–∞–π–ª (terraform.tfstate) —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ HCL —Ä–µ—Å—É—Ä—Å—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ –æ–±–ª–∞–∫–µ.

‚Ä¢ –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Terraform –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –ø—Ä–∏ terraform apply.

1. **–ì–¥–µ –µ–≥–æ —Ö—Ä–∞–Ω—è—Ç?**

‚Ä¢ **–õ–æ–∫–∞–ª—å–Ω–æ** (terraform.tfstate –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏) ‚Üí –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

‚Ä¢ **–£–¥–∞–ª–µ–Ω–Ω–æ** (S3, GCS, Azure Blob, Terraform Cloud) ‚Üí –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π.

2. **–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å?**

‚Ä¢ **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ** ‚Üí —Ä–µ—à–∞–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (dynamodb –¥–ª—è S3 backend).

‚Ä¢ **–ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Üí —Ä–µ—à–∞–µ—Ç—Å—è —Å terraform state encrypt, terraform_remote_state, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ vault.

‚Ä¢ **–ü–æ—Ç–µ—Ä—è state-—Ñ–∞–π–ª–∞** ‚Üí –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω –±–µ–∑ –±—ç–∫–∞–ø–∞, —Ç–µ—Ä—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ Terraform.
	‚Ä¢ –ï—Å–ª–∏ state **—É–¥–∞–ª–µ–Ω**, –Ω–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—â–µ –µ—Å—Ç—å ‚Üí **terraform import** –ø–æ–º–æ–∂–µ—Ç.
	‚Ä¢ –ï—Å–ª–∏ state —É–¥–∞–ª–µ–Ω **–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ—Ç** ‚Üí **–ø–æ—Ç–µ—Ä—è–Ω–æ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ**.
	‚Ä¢ **–í—ã–≤–æ–¥:** **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –±—ç–∫–∞–ø—ã state-—Ñ–∞–π–ª–æ–≤!** (S3 + DynamoDB, GCS, Azure Blob).

#### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ terraform

–≠—Ç–æ —É—Ç–∏–ª–∏—Ç–∞, –ø—Ä–æ—Å–ª–æ–π–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç Terraform –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º API –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–¥–π–µ—Ä–∞.

–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—Å—É—Ä—Å –≤ terraform

–≠—Ç–æ –∫–∞–∫–æ–π —Ç–æ –±–ª–æ–∫ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –ö–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å –∏–º–µ–µ—Ç —Å–≤–æ–∏ –∫–∞–∫–∏–µ —Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –†–µ—Å—É—Ä—Å –∏–º–µ–µ—Ç —Å–≤–æ–π –∫–∞–∫–æ–π —Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (ID, ARN –∏ —Ç–¥).

–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞, —Å–µ—Ç—å, –¥–∏—Å–∫, –ø–æ—Ä—Ç, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –∏ —Ç–¥.


## Ansible

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã Ansible

#### –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (Inventory)

- c–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç–∞—Ç–∏—á–Ω—ã–º –≤ –≤–∏–¥–µ —Ç–µ–∫c—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ¬†`.ini`¬†–∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –≤ –≤–∏–¥–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏–ª–∏ –ø–ª–∞–≥–∏–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, Openstack API –∏–ª–∏ –±–∞–∑–∞ LDAP.

```
$ cat hosts
[web]
nginx01
nginx02
nginx03

[mysql]
mysql01
mysql02
mysql03

[prod:children]
web
mysql

[devel]
dev-nginx01
dev-mysql01
```

–î–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–æ–≤ web, mysql, prod –∏ devel, –≥—Ä—É–ø–ø–∞ prod –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥—Ä—É–ø–ø web –∏ mysql.
#### –ó–∞–¥–∞–Ω–∏–µ (Task)

- –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–º —Ö–æ—Å—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```yaml
apt:
package: nginx
state: present
```

–î–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –∫–æ–º–∞–Ω–¥–µ¬†`apt install nginx`
#### –°—Ü–µ–Ω–∞—Ä–∏–π (Play¬†–∏–ª–∏¬†–ü–ª–µ–π–±—É–∫ (Playbook)

- —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```yaml
$ cat prod-playbook.yml
---
- hosts: nginx
tasks:
- apt:
	package: nginx
	state: present
- shell: whoami
```
#### –†–æ–ª—å (Role)

- –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç –Ω–∞–±–æ—Ä –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –¥—Ä—É–≥–∏—Ö —Ä–æ–ª–µ–π, –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª—ã –∏ —Ç–µ–º–ø–ª–µ–π—Ç—ã, —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–¥–∞–Ω–∏—è(Tasks).
#### –§–∞–∫—Ç—ã (Facts)

- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ—Å—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—Ä—Å–∏—é –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞, IP –∞–¥—Ä–µ—Å–∞ –∏ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã. Ansible –∑–∞–±–∏—Ä–∞–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å —Ö–æ—Å—Ç–∞, –∏ –Ω–∞ –Ω–µ–µ –º–æ–∂–Ω–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ –ø–ª–µ–π–±—É–∫–æ–≤ –∏ —Ä–æ–ª–µ–π.

–°–±–æ—Ä —Ñ–∞–∫—Ç–æ–≤ —Ö–æ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, –ø–æ—ç—Ç–æ–º—É –∏—Ö –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏—Ö —Å–±–æ—Ä –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–ª–µ–π–±—É–∫–∞.

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ Ansible

–í Ansible –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö: –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, –≤ —Ä–æ–ª—è—Ö, —á–µ—Ä–µ–∑ `set_fact`, –≤ playbook, —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ —Ç.–¥. –ï—Å–ª–∏ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö ‚Äî Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∑–Ω–∞—á–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º**.
#### üìä –ü–æ—Ä—è–¥–æ–∫ –æ—Ç –Ω–∏–∑—à–µ–≥–æ –∫ –≤—ã—Å—à–µ–º—É:

1. **`defaults` –≤ —Ä–æ–ª—è—Ö** ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`roles/myrole/defaults/main.yml`)
2. **–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å**:
   - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `inventory.ini` (`host var`, `group:vars`)
3. **`group_vars/`** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä—É–ø–ø
4. **`host_vars/`** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
5. **`ansible_facts`** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `set_fact`
6. **`vars` –≤ playbook** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ `vars:` –±–ª–æ–∫–∞
7. **`vars` –≤ task** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∑–∞–¥–∞—á–µ
8. **`register`** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
9. **`--extra-vars`** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ CLI (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
#### üß© –ü—Ä–∏–º–µ—Ä—ã –ø–æ —É—Ä–æ–≤–Ω—è–º

##### 1. `defaults` –≤ —Ä–æ–ª—è—Ö (—Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

```yaml
# roles/myrole/defaults/main.yml
app_port: 5000
env: \"dev\"
```
##### 2. –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å

```ini
[web]
web01 ansible_host=192.168.0.10 app_port=8081

[web:vars]
region=eu
```
##### 3. `group_vars/` –∏ `host_vars/`

–§–∞–π–ª—ã:

- `group_vars/web.yml`
- `host_vars/web01.yml`

–ü—Ä–∏–º–µ—Ä:

```yaml
# group_vars/web.yml
app_port: 8080
env: \"staging\"
```

```yaml
# host_vars/web01.yml
app_port: 9090
```

‚Üí –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `host_vars` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç `group_vars`.
##### 4. `ansible_facts` (–≤ —Ç–æ–º —á–∏—Å–ª–µ `set_fact`)

```yaml
- name: Set fact
  set_fact:
    app_port: 7070
```
##### 5. `vars` –≤ playbook

```yaml
- hosts: all
  vars:
    app_port: 6060
```
##### 6. `vars` –≤ task

```yaml
- name: Show port
  debug:
    msg: \"Port is {{ app_port }}\"
  vars:
    app_port: 5050
```
##### 7. `register`

```yaml
- name: Get hostname
  command: hostname
  register: hostname_output
```

‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ `{{ hostname_output.stdout }}`.
##### 8. `--extra-vars` (–Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

```bash
ansible-playbook site.yml --extra-vars \"app_port=4040 env=prod\"
```
### üß† –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Ansible –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- –ò—Å–ø–æ–ª—å–∑—É–π `defaults` –≤ —Ä–æ–ª—è—Ö –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ó–∞–¥–∞–≤–∞–π —Ö–æ—Å—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `host_vars/` –∏ `group_vars/`.
- –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `--extra-vars`.
---
### –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã —Ö–µ–Ω–¥–ª–µ—Ä—ã, handlers?

–ó–∞–¥–∞—á—É –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ nginx –∏ —Ö–æ—Ç–∏–º –µ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```yaml
---
- hosts: testbox
  sudo: yes
  tasks:
   - name: Install Nginx
	 yum: pkg=nginx state=latest
	 notify:
		 - NGINX start

  handlers:
	- name: NGINX start
	  service: name=nginx state=started
```

### IAC and –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**¬†- —ç—Ç–æ —Ç–∞–∫–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è, —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –±—É–¥–µ—Ç –¥–∞–≤–∞—Ç—å —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ –∏ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫.

–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–∏—Å—Ç–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞, –Ω–µ –∏–∑–º–µ–Ω—è—Ç, –Ω–µ —Å–ª–æ–º–∞—é—Ç –∏ –Ω–µ –≤—ã–¥–∞–¥—É—Ç –æ—à–∏–±–æ–∫ –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–º —Ö–æ—Å—Ç–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ö–æ—Å—Ç, –¥–ª—è bash —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```yaml
useradd newuser -ms /bin/bash
```

–ù–æ –µ—Å–ª–∏ –º—ã –∑–∞–ø—É—Å—Ç–∏–º –∫–æ–º–∞–Ω–¥—É –≤—Ç–æ—Ä–æ–π —Ä–∞–∑, —Ç–æ –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É

```yaml
useradd newuser -ms /bin/bash
useradd: user 'newuser' already exists
```

–ü–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:

```yaml
id newuser || useradd newuser -ms /bin/bash
```

–í —Å–ª—É—á–∞–µ Ansible –º—ã —Ç–æ–ª—å–∫–æ –¥–µ–∫–ª–∞—Ä–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```yaml
- hosts: localhost
  gather_facts: no
  tasks:
    - user:
        name: newuser
        shell: /bin/bash
        state: present
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–ª–µ–π–±—É–∫ Ansible –æ—Ç–≤–µ—Ç–∏—Ç:

```yaml
TASK [user] ***
changed: [localhost] => {
  "ansible_facts": {
    "discovered_interpreter_python": "/usr/bin/python3"
  },
  "changed": true,
  "comment": "",
  "create_home": true,
  "group": 1001,
  "home": "/home/newuser",
  "name": "newuser",
  "shell": "/bin/bash",
  "state": "present",
  "system": false,
  "uid": 1001
}
```

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º:

```yaml
TASK [user] ***
ok: [localhost] => {
  "ansible_facts": {
    "discovered_interpreter_python": "/usr/bin/python3"
  },
  "append": false,
  "changed": false,
  "comment": "",
  "group": 1001,
  "home": "/home/newuser",
  "move_home": false,
  "name": "newuser",
  "shell": "/bin/bash",
  "state":
  "present",
  "uid": 1001
}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞–Ω–∏—è —Å–º–µ–Ω–∏–ª—Å—è —Å¬†`changed`¬†–Ω–∞¬†`ok`¬†–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤–µ—Ä–Ω—É–ª –∑–Ω–∞—á–µ–Ω–∏–µ¬†`"changed": false`

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç—É —Å–∞–º—É—é –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–Ω–æ–º—É –≤ –∫–æ–¥–µ –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.

–≠—Ç–æ –∏ –µ—Å—Ç—å¬†**Ia–° - Infrastructure as Code - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥**

### –î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω ad hoc –≤ ansible?

–≠—Ç–æ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∞–Ω—Å–∏–±–ª –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

